/*!
 * typeahead.js 0.10.5
 * https://github.com/twitter/typeahead.js
 * Copyright 2013-2014 Twitter, Inc. and other contributors; Licensed MIT
 */
(function(b){var q=function(){return{isMsie:function(){return/(msie|trident)/i.test(navigator.userAgent)?navigator.userAgent.match(/(msie |rv:)(\d+(.\d+)?)/i)[2]:false},isBlankString:function(v){return !v||/^\s*$/.test(v)},escapeRegExChars:function(v){return v.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&")},isString:function(v){return typeof v==="string"},isNumber:function(v){return typeof v==="number"},isArray:b.isArray,isFunction:b.isFunction,isObject:b.isPlainObject,isUndefined:function(v){return typeof v==="undefined"},toStr:function u(v){return q.isUndefined(v)||v===null?"":v+""},bind:b.proxy,each:function(y,v){b.each(y,w);function w(z,A){return v(A,z)}},map:b.map,filter:b.grep,every:function(w,y){var v=true;if(!w){return v}b.each(w,function(z,A){if(!(v=y.call(null,A,z,w))){return false}});return !!v},some:function(w,y){var v=false;if(!w){return v}b.each(w,function(z,A){if(v=y.call(null,A,z,w)){return false}});return !!v},mixin:b.extend,getUniqueId:function(){var v=0;return function(){return v++}}(),templatify:function t(w){return b.isFunction(w)?w:v;function v(){return String(w)}},defer:function(v){setTimeout(v,0)},debounce:function(y,A,w){var z,v;return function(){var E=this,D=arguments,C,B;C=function(){z=null;if(!w){v=y.apply(E,D)}};B=w&&!z;clearTimeout(z);z=setTimeout(C,A);if(B){v=y.apply(E,D)}return v}},throttle:function(B,D){var z,y,C,v,A,w;A=0;w=function(){A=new Date();C=null;v=B.apply(z,y)};return function(){var E=new Date(),F=D-(E-A);z=this;y=arguments;if(F<=0){clearTimeout(C);C=null;A=E;v=B.apply(z,y)}else{if(!C){C=setTimeout(w,F)}}return v}},noop:function(){}}}();var l="0.10.5";var n=function(){return{nonword:t,whitespace:u,obj:{nonword:v(t),whitespace:v(u)}};function u(w){w=q.toStr(w);return w?w.split(/\s+/):[]}function t(w){w=q.toStr(w);return w?w.split(/\W+/):[]}function v(y){return function w(){var z=[].slice.call(arguments,0);return function A(C){var B=[];q.each(z,function(D){B=B.concat(y(q.toStr(C[D])))});return B}}}}();var d=function(){function u(C){this.maxSize=q.isNumber(C)?C:100;this.reset();if(this.maxSize<=0){this.set=this.get=b.noop}}q.mixin(u.prototype,{set:function B(C,F){var E=this.list.tail,D;if(this.size>=this.maxSize){this.list.remove(E);delete this.hash[E.key]}if(D=this.hash[C]){D.val=F;this.list.moveToFront(D)}else{D=new v(C,F);this.list.add(D);this.hash[C]=D;this.size++}},get:function w(C){var D=this.hash[C];if(D){this.list.moveToFront(D);return D.val}},reset:function z(){this.size=0;this.hash={};this.list=new y()}});function y(){this.head=this.tail=null}q.mixin(y.prototype,{add:function A(C){if(this.head){C.next=this.head;this.head.prev=C}this.head=C;this.tail=this.tail||C},remove:function t(C){C.prev?C.prev.next=C.next:this.head=C.next;C.next?C.next.prev=C.prev:this.tail=C.prev},moveToFront:function(C){this.remove(C);this.add(C)}});function v(C,D){this.key=C;this.val=D;this.prev=this.next=null}return u}();var o=function(){var t,u;try{t=window.localStorage;t.setItem("~~~","!");t.removeItem("~~~")}catch(z){t=null}function w(B){this.prefix=["__",B,"__"].join("");this.ttlKey="__ttl__";this.keyMatcher=new RegExp("^"+q.escapeRegExChars(this.prefix))}if(t&&window.JSON){u={_prefix:function(B){return this.prefix+B},_ttlKey:function(B){return this._prefix(B)+this.ttlKey},get:function(B){if(this.isExpired(B)){this.remove(B)}return A(t.getItem(this._prefix(B)))},set:function(C,D,B){if(q.isNumber(B)){t.setItem(this._ttlKey(C),y(v()+B))}else{t.removeItem(this._ttlKey(C))}return t.setItem(this._prefix(C),y(D))},remove:function(B){t.removeItem(this._ttlKey(B));t.removeItem(this._prefix(B));return this},clear:function(){var D,C,E=[],B=t.length;for(D=0;D<B;D++){if((C=t.key(D)).match(this.keyMatcher)){E.push(C.replace(this.keyMatcher,""))}}for(D=E.length;D--;){this.remove(E[D])}return this},isExpired:function(C){var B=A(t.getItem(this._ttlKey(C)));return q.isNumber(B)&&v()>B?true:false}}}else{u={get:q.noop,set:q.noop,remove:q.noop,clear:q.noop,isExpired:q.noop}}q.mixin(w.prototype,u);return w;function v(){return new Date().getTime()}function y(B){return JSON.stringify(q.isUndefined(B)?null:B)}function A(B){return JSON.parse(B)}}();var p=function(){var v=0,y={},t=6,w=new d(10);function B(C){C=C||{};this.cancelled=false;this.lastUrl=null;this._send=C.transport?z(C.transport):b.ajax;this._get=C.rateLimiter?C.rateLimiter(this._get):this._get;this._cache=C.cache===false?new d(0):w}B.setMaxPendingRequests=function u(C){t=C};B.resetCache=function A(){w.reset()};q.mixin(B.prototype,{_get:function(G,J,D){var I=this,H;if(this.cancelled||G!==this.lastUrl){return}if(H=y[G]){H.done(F).fail(E)}else{if(v<t){v++;y[G]=this._send(G,J).done(F).fail(E).always(C)}else{this.onDeckRequestArgs=[].slice.call(arguments,0)}}function F(K){D&&D(null,K);I._cache.set(G,K)}function E(){D&&D(true)}function C(){v--;delete y[G];if(I.onDeckRequestArgs){I._get.apply(I,I.onDeckRequestArgs);I.onDeckRequestArgs=null}}},get:function(D,F,C){var E;if(q.isFunction(F)){C=F;F={}}this.cancelled=false;this.lastUrl=D;if(E=this._cache.get(D)){q.defer(function(){C&&C(null,E)})}else{this._get(D,F,C)}return !!E},cancel:function(){this.cancelled=true}});return B;function z(C){return function D(F,I){var E=b.Deferred();C(F,I,H,G);return E;function H(J){q.defer(function(){E.resolve(J)})}function G(J){q.defer(function(){E.reject(J)})}}}}();var i=function(){function t(D){D=D||{};if(!D.datumTokenizer||!D.queryTokenizer){b.error("datumTokenizer and queryTokenizer are both required")}this.datumTokenizer=D.datumTokenizer;this.queryTokenizer=D.queryTokenizer;this.reset()}q.mixin(t.prototype,{bootstrap:function v(D){this.datums=D.datums;this.trie=D.trie},add:function(E){var D=this;E=q.isArray(E)?E:[E];q.each(E,function(F){var H,G;H=D.datums.push(F)-1;G=y(D.datumTokenizer(F));q.each(G,function(I){var L,K,J;L=D.trie;K=I.split("");while(J=K.shift()){L=L.children[J]||(L.children[J]=B());L.ids.push(H)}})})},get:function u(F){var D=this,G,E;G=y(this.queryTokenizer(F));q.each(G,function(H){var L,K,J,I;if(E&&E.length===0){return false}L=D.trie;K=H.split("");while(L&&(J=K.shift())){L=L.children[J]}if(L&&K.length===0){I=L.ids.slice(0);E=E?z(E,I):I}else{E=[];return false}});return E?q.map(w(E),function(H){return D.datums[H]}):[]},reset:function A(){this.datums=[];this.trie=B()},serialize:function C(){return{datums:this.datums,trie:this.trie}}});return t;function y(D){D=q.filter(D,function(E){return !!E});D=q.map(D,function(E){return E.toLowerCase()});return D}function B(){return{ids:[],children:{}}}function w(H){var E={},G=[];for(var F=0,D=H.length;F<D;F++){if(!E[H[F]]){E[H[F]]=true;G.push(H[F])}}return G}function z(I,G){var E=0,H=0,K=[];I=I.sort(J);G=G.sort(J);var F=I.length,D=G.length;while(E<F&&H<D){if(I[E]<G[H]){E++}else{if(I[E]>G[H]){H++}else{K.push(I[E]);E++;H++}}}return K;function J(M,L){return M-L}}}();var f=function(){return{local:v,prefetch:t,remote:u};function v(w){return w.local||null}function t(z){var y,w;w={url:null,thumbprint:"",ttl:24*60*60*1000,filter:null,ajax:{}};if(y=z.prefetch||null){y=q.isString(y)?{url:y}:y;y=q.mixin(w,y);y.thumbprint=l+y.thumbprint;y.ajax.type=y.ajax.type||"GET";y.ajax.dataType=y.ajax.dataType||"json";!y.url&&b.error("prefetch requires url to be set")}return y}function u(B){var z,A;A={url:null,cache:true,wildcard:"%QUERY",replace:null,rateLimitBy:"debounce",rateLimitWait:300,send:null,filter:null,ajax:{}};if(z=B.remote||null){z=q.isString(z)?{url:z}:z;z=q.mixin(A,z);z.rateLimiter=/^throttle$/i.test(z.rateLimitBy)?y(z.rateLimitWait):w(z.rateLimitWait);z.ajax.type=z.ajax.type||"GET";z.ajax.dataType=z.ajax.dataType||"json";delete z.rateLimitBy;delete z.rateLimitWait;!z.url&&b.error("remote requires url to be set")}return z;function w(C){return function(D){return q.debounce(D,C)}}function y(C){return function(D){return q.throttle(D,C)}}}}();(function(F){var t,A;t=F.Bloodhound;A={data:"data",protocol:"protocol",thumbprint:"thumbprint"};F.Bloodhound=v;function v(N){if(!N||!N.local&&!N.prefetch&&!N.remote){b.error("one of local, prefetch, or remote is required")}this.limit=N.limit||5;this.sorter=D(N.sorter);this.dupDetector=N.dupDetector||C;this.local=f.local(N);this.prefetch=f.prefetch(N);this.remote=f.remote(N);this.cacheKey=this.prefetch?this.prefetch.cacheKey||this.prefetch.url:null;this.index=new i({datumTokenizer:N.datumTokenizer,queryTokenizer:N.queryTokenizer});this.storage=this.cacheKey?new o(this.cacheKey):null}v.noConflict=function M(){F.Bloodhound=t;return v};v.tokenizers=n;q.mixin(v.prototype,{_loadPrefetch:function w(R){var O=this,Q,N;if(Q=this._readFromStorage(R.thumbprint)){this.index.bootstrap(Q);N=b.Deferred().resolve()}else{N=b.ajax(R.url,R.ajax).done(P)}return N;function P(S){O.clear();O.add(R.filter?R.filter(S):S);O._saveToStorage(O.index.serialize(),R.thumbprint,R.ttl)}},_getFromRemote:function z(S,N){var R=this,P,Q;if(!this.transport){return}S=S||"";Q=encodeURIComponent(S);P=this.remote.replace?this.remote.replace(this.remote.url,S):this.remote.url.replace(this.remote.wildcard,Q);return this.transport.get(P,this.remote.ajax,O);function O(T,U){T?N([]):N(R.remote.filter?R.remote.filter(U):U)}},_cancelLastRemoteRequest:function L(){this.transport&&this.transport.cancel()},_saveToStorage:function G(P,O,N){if(this.storage){this.storage.set(A.data,P,N);this.storage.set(A.protocol,location.protocol,N);this.storage.set(A.thumbprint,O,N)}},_readFromStorage:function K(O){var N={},P;if(this.storage){N.data=this.storage.get(A.data);N.protocol=this.storage.get(A.protocol);N.thumbprint=this.storage.get(A.thumbprint)}P=N.thumbprint!==O||N.protocol!==location.protocol;return N.data&&!P?N.data:null},_initialize:function u(){var Q=this,P=this.local,N;N=this.prefetch?this._loadPrefetch(this.prefetch):b.Deferred().resolve();P&&N.done(O);this.transport=this.remote?new p(this.remote):null;return this.initPromise=N.promise();function O(){Q.add(q.isFunction(P)?P():P)}},initialize:function u(N){return !this.initPromise||N?this._initialize():this.initPromise},add:function B(N){this.index.add(N)},get:function I(R,N){var P=this,Q=[],O=false;Q=this.index.get(R);Q=this.sorter(Q).slice(0,this.limit);Q.length<this.limit?O=this._getFromRemote(R,S):this._cancelLastRemoteRequest();if(!O){(Q.length>0||!this.transport)&&N&&N(Q)}function S(U){var T=Q.slice(0);q.each(U,function(W){var V;V=q.some(T,function(X){return P.dupDetector(W,X)});!V&&T.push(W);return T.length<P.limit});N&&N(P.sorter(T))}},clear:function E(){this.index.reset()},clearPrefetchCache:function y(){this.storage&&this.storage.clear()},clearRemoteCache:function H(){this.transport&&p.resetCache()},ttAdapter:function J(){return q.bind(this.get,this)}});return v;function D(O){return q.isFunction(O)?N:P;function N(Q){return Q.sort(O)}function P(Q){return Q}}function C(){return false}})(this);var h=function(){return{wrapper:'<span class="twitter-typeahead"></span>',dropdown:'<span class="tt-dropdown-menu"></span>',dataset:'<div class="tt-dataset-%CLASS%"></div>',suggestions:'<span class="tt-suggestions"></span>',suggestion:'<div class="tt-suggestion"></div>'}}();var g=function(){var t={wrapper:{position:"relative",display:"inline-block"},hint:{position:"absolute",top:"0",left:"0",borderColor:"transparent",boxShadow:"none",opacity:"1"},input:{position:"relative",verticalAlign:"top",backgroundColor:"transparent"},inputWithNoHint:{position:"relative",verticalAlign:"top"},dropdown:{position:"absolute",top:"100%",left:"0",zIndex:"100",display:"none"},suggestions:{display:"block"},suggestion:{whiteSpace:"nowrap",cursor:"pointer"},suggestionChild:{whiteSpace:"normal"},ltr:{left:"0",right:"auto"},rtl:{left:"auto",right:" 0"}};if(q.isMsie()){q.mixin(t.input,{backgroundImage:"url(data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7)"})}if(q.isMsie()&&q.isMsie()<=7){q.mixin(t.input,{marginTop:"-1px"})}return t}();var a=function(){var u="typeahead:";function t(v){if(!v||!v.el){b.error("EventBus initialized without el")}this.$el=b(v.el)}q.mixin(t.prototype,{trigger:function(w){var v=[].slice.call(arguments,1);this.$el.trigger(u+w,v)}});return t}();var e=function(){var v=/\s+/,A=t();return{onSync:B,onAsync:u,off:w,trigger:y};function C(I,G,E,F){var H;if(!E){return this}G=G.split(v);E=F?D(E,F):E;this._callbacks=this._callbacks||{};while(H=G.shift()){this._callbacks[H]=this._callbacks[H]||{sync:[],async:[]};this._callbacks[H][I].push(E)}return this}function u(G,E,F){return C.call(this,"async",G,E,F)}function B(G,E,F){return C.call(this,"sync",G,E,F)}function w(E){var F;if(!this._callbacks){return this}E=E.split(v);while(F=E.shift()){delete this._callbacks[F]}return this}function y(F){var G,H,E,I,J;if(!this._callbacks){return this}F=F.split(v);E=[].slice.call(arguments,1);while((G=F.shift())&&(H=this._callbacks[G])){I=z(H.sync,this,[G].concat(E));J=z(H.async,this,[G].concat(E));I()&&A(J)}return this}function z(H,G,F){return E;function E(){var K;for(var J=0,I=H.length;!K&&J<I;J+=1){K=H[J].apply(G,F)===false}return !K}}function t(){var F;if(window.setImmediate){F=function G(H){setImmediate(function(){H()})}}else{F=function E(H){setTimeout(function(){H()},0)}}return F}function D(F,E){return F.bind?F.bind(E):function(){F.apply(E,[].slice.call(arguments,0))}}}();var c=function(w){var v={node:null,pattern:null,tagName:"strong",className:null,wordsOnly:false,caseSensitive:false};return function u(B){var y;B=q.mixin({},v,B);if(!B.node||!B.pattern){return}B.pattern=q.isArray(B.pattern)?B.pattern:[B.pattern];y=t(B.pattern,B.caseSensitive,B.wordsOnly);z(B.node,A);function A(F){var D,C,E;if(D=y.exec(F.data)){E=w.createElement(B.tagName);B.className&&(E.className=B.className);C=F.splitText(D.index);C.splitText(D[0].length);E.appendChild(C.cloneNode(true));F.parentNode.replaceChild(E,C)}return !!D}function z(F,G){var D,E=3;for(var C=0;C<F.childNodes.length;C++){D=F.childNodes[C];if(D.nodeType===E){C+=G(D)?1:0}else{z(D,G)}}}};function t(B,z,E){var D=[],C;for(var A=0,y=B.length;A<y;A++){D.push(q.escapeRegExChars(B[A]))}C=E?"\\b("+D.join("|")+")\\b":"("+D.join("|")+")";return z?new RegExp(C):new RegExp(C,"i")}}(window.document);var k=function(){var Q;Q={9:"tab",27:"esc",37:"left",39:"right",13:"enter",38:"up",40:"down"};function N(Z){var X=this,Y,U,W,V;Z=Z||{};if(!Z.input){b.error("input is missing")}Y=q.bind(this._onBlur,this);U=q.bind(this._onFocus,this);W=q.bind(this._onKeydown,this);V=q.bind(this._onInput,this);this.$hint=b(Z.hint);this.$input=b(Z.input).on("blur.tt",Y).on("focus.tt",U).on("keydown.tt",W);if(this.$hint.length===0){this.setHint=this.getHint=this.clearHint=this.clearHintIfInvalid=q.noop}if(!q.isMsie()){this.$input.on("input.tt",V)}else{this.$input.on("keydown.tt keypress.tt cut.tt paste.tt",function(aa){if(Q[aa.which||aa.keyCode]){return}q.defer(q.bind(X._onInput,X,aa))})}this.query=this.$input.val();this.$overflowHelper=G(this.$input)}N.normalizeQuery=function(U){return(U||"").replace(/^\s*/g,"").replace(/\s{2,}/g," ")};q.mixin(N.prototype,e,{_onBlur:function E(){this.resetInputValue();this.trigger("blurred")},_onFocus:function y(){this.trigger("focused")},_onKeydown:function S(U){var V=Q[U.which||U.keyCode];this._managePreventDefault(V,U);if(V&&this._shouldTrigger(V,U)){this.trigger(V+"Keyed",U)}},_onInput:function u(){this._checkInputValue()},_managePreventDefault:function A(Y,X){var W,V,U;switch(Y){case"tab":V=this.getHint();U=this.getInputValue();W=V&&V!==U&&!H(X);break;case"up":case"down":W=!H(X);break;default:W=false}W&&X.preventDefault()},_shouldTrigger:function T(W,V){var U;switch(W){case"tab":U=!H(V);break;default:U=true}return U},_checkInputValue:function B(){var U,V,W;U=this.getInputValue();V=D(U,this.query);W=V?this.query.length!==U.length:false;this.query=U;if(!V){this.trigger("queryChanged",this.query)}else{if(W){this.trigger("whitespaceChanged",this.query)}}},focus:function J(){this.$input.focus()},blur:function O(){this.$input.blur()},getQuery:function L(){return this.query},setQuery:function K(U){this.query=U},getInputValue:function z(){return this.$input.val()},setInputValue:function C(V,U){this.$input.val(V);U?this.clearHint():this._checkInputValue()},resetInputValue:function w(){this.setInputValue(this.query,true)},getHint:function v(){return this.$hint.val()},setHint:function P(U){this.$hint.val(U)},clearHint:function F(){this.setHint("")},clearHintIfInvalid:function t(){var X,W,U,V;X=this.getInputValue();W=this.getHint();U=X!==W&&W.indexOf(X)===0;V=X!==""&&U&&!this.hasOverflow();!V&&this.clearHint()},getLanguageDirection:function I(){return(this.$input.css("direction")||"ltr").toLowerCase()},hasOverflow:function M(){var U=this.$input.width()-2;this.$overflowHelper.text(this.getInputValue());return this.$overflowHelper.width()>=U},isCursorAtEnd:function(){var V,W,U;V=this.$input.val().length;W=this.$input[0].selectionStart;if(q.isNumber(W)){return W===V}else{if(document.selection){U=document.selection.createRange();U.moveStart("character",-V);return V===U.text.length}}return true},destroy:function R(){this.$hint.off(".tt");this.$input.off(".tt");this.$hint=this.$input=this.$overflowHelper=null}});return N;function G(U){return b('<pre aria-hidden="true"></pre>').css({position:"absolute",visibility:"hidden",whiteSpace:"pre",fontFamily:U.css("font-family"),fontSize:U.css("font-size"),fontStyle:U.css("font-style"),fontVariant:U.css("font-variant"),fontWeight:U.css("font-weight"),wordSpacing:U.css("word-spacing"),letterSpacing:U.css("letter-spacing"),textIndent:U.css("text-indent"),textRendering:U.css("text-rendering"),textTransform:U.css("text-transform")}).insertAfter(U)}function D(V,U){return N.normalizeQuery(V)===N.normalizeQuery(U)}function H(U){return U.altKey||U.ctrlKey||U.metaKey||U.shiftKey}}();var s=function(){var u="ttDataset",J="ttValue",D="ttDatum";function t(K){K=K||{};K.templates=K.templates||{};if(!K.source){b.error("missing source")}if(K.name&&!w(K.name)){b.error("invalid dataset name: "+K.name)}this.query=null;this.highlight=!!K.highlight;this.name=K.name||q.getUniqueId();this.source=K.source;this.displayFn=y(K.display||K.displayKey);this.templates=z(K.templates,this.displayFn);this.$el=b(h.dataset.replace("%CLASS%",this.name))}t.extractDatasetName=function H(K){return b(K).data(u)};t.extractValue=function E(K){return b(K).data(J)};t.extractDatum=function E(K){return b(K).data(D)};q.mixin(t.prototype,e,{_render:function v(Q,K){if(!this.$el){return}var P=this,M;this.$el.empty();M=K&&K.length;if(!M&&this.templates.empty){this.$el.html(L()).prepend(P.templates.header?O():null).append(P.templates.footer?N():null)}else{if(M){this.$el.html(R()).prepend(P.templates.header?O():null).append(P.templates.footer?N():null)}}this.trigger("rendered");function L(){return P.templates.empty({query:Q,isEmpty:true})}function R(){var T,S;T=b(h.suggestions).css(g.suggestions);S=q.map(K,U);T.append.apply(T,S);P.highlight&&c({className:"tt-highlight",node:T[0],pattern:Q});return T;function U(V){var W;W=b(h.suggestion).append(P.templates.suggestion(V)).data(u,P.name).data(J,P.displayFn(V)).data(D,V);W.children().each(function(){b(this).css(g.suggestionChild)});return W}}function O(){return P.templates.header({query:Q,isEmpty:!M})}function N(){return P.templates.footer({query:Q,isEmpty:!M})}},getRoot:function F(){return this.$el},update:function A(M){var L=this;this.query=M;this.canceled=false;this.source(M,K);function K(N){if(!L.canceled&&M===L.query){L._render(M,N)}}},cancel:function I(){this.canceled=true},clear:function C(){this.cancel();this.$el.empty();this.trigger("rendered")},isEmpty:function B(){return this.$el.is(":empty")},destroy:function G(){this.$el=null}});return t;function y(K){K=K||"value";return q.isFunction(K)?K:L;function L(M){return M[K]}}function z(L,M){return{empty:L.empty&&q.templatify(L.empty),header:L.header&&q.templatify(L.header),footer:L.footer&&q.templatify(L.footer),suggestion:L.suggestion||K};function K(N){return"<p>"+M(N)+"</p>"}}function w(K){return/^[_a-zA-Z0-9-]+$/.test(K)}}();var m=function(){function N(W){var U=this,S,V,T;W=W||{};if(!W.menu){b.error("menu is required")}this.isOpen=false;this.isEmpty=true;this.datasets=q.map(W.datasets,E);S=q.bind(this._onSuggestionClick,this);V=q.bind(this._onSuggestionMouseEnter,this);T=q.bind(this._onSuggestionMouseLeave,this);this.$menu=b(W.menu).on("click.tt",".tt-suggestion",S).on("mouseenter.tt",".tt-suggestion",V).on("mouseleave.tt",".tt-suggestion",T);q.each(this.datasets,function(X){U.$menu.append(X.getRoot());X.onSync("rendered",U._onRendered,U)})}q.mixin(N.prototype,e,{_onSuggestionClick:function M(S){this.trigger("suggestionClicked",b(S.currentTarget))},_onSuggestionMouseEnter:function t(S){this._removeCursor();this._setCursor(b(S.currentTarget),true)},_onSuggestionMouseLeave:function H(){this._removeCursor()},_onRendered:function A(){this.isEmpty=q.every(this.datasets,S);this.isEmpty?this._hide():this.isOpen&&this._show();this.trigger("datasetRendered");function S(T){return T.isEmpty()}},_hide:function(){this.$menu.hide()},_show:function(){this.$menu.css("display","block")},_getSuggestions:function z(){return this.$menu.find(".tt-suggestion")},_getCursor:function w(){return this.$menu.find(".tt-cursor").first()},_setCursor:function P(T,S){T.first().addClass("tt-cursor");!S&&this.trigger("cursorMoved")},_removeCursor:function v(){this._getCursor().removeClass("tt-cursor")},_moveCursor:function u(S){var U,T,W,V;if(!this.isOpen){return}T=this._getCursor();U=this._getSuggestions();this._removeCursor();W=U.index(T)+S;W=(W+1)%(U.length+1)-1;if(W===-1){this.trigger("cursorRemoved");return}else{if(W<-1){W=U.length-1}}this._setCursor(V=U.eq(W));this._ensureVisible(V)},_ensureVisible:function L(V){var S,U,T,W;S=V.position().top;U=S+V.outerHeight(true);T=this.$menu.scrollTop();W=this.$menu.height()+parseInt(this.$menu.css("paddingTop"),10)+parseInt(this.$menu.css("paddingBottom"),10);if(S<0){this.$menu.scrollTop(T+S)}else{if(W<U){this.$menu.scrollTop(T+(U-W))}}},close:function I(){if(this.isOpen){this.isOpen=false;this._removeCursor();this._hide();this.trigger("closed")}},open:function G(){if(!this.isOpen){this.isOpen=true;!this.isEmpty&&this._show();this.trigger("opened")}},setLanguageDirection:function Q(S){this.$menu.css(S==="ltr"?g.ltr:g.rtl)},moveCursorUp:function B(){this._moveCursor(-1)},moveCursorDown:function R(){this._moveCursor(+1)},getDatumForSuggestion:function D(T){var S=null;if(T.length){S={raw:s.extractDatum(T),value:s.extractValue(T),datasetName:s.extractDatasetName(T)}}return S},getDatumForCursor:function y(){return this.getDatumForSuggestion(this._getCursor().first())},getDatumForTopSuggestion:function K(){return this.getDatumForSuggestion(this._getSuggestions().first())},update:function C(S){q.each(this.datasets,T);function T(U){U.update(S)}},empty:function F(){q.each(this.datasets,S);this.isEmpty=true;function S(T){T.clear()}},isVisible:function J(){return this.isOpen&&!this.isEmpty},destroy:function O(){this.$menu.off(".tt");this.$menu=null;q.each(this.datasets,S);function S(T){T.destroy()}}});return N;function E(S){return new s(S)}}();var j=function(){var V="ttAttrs";function F(ab){var aa,ac,Z;ab=ab||{};if(!ab.input){b.error("missing input")}this.isActivated=false;this.autoselect=!!ab.autoselect;this.minLength=q.isNumber(ab.minLength)?ab.minLength:1;this.$node=P(ab.input,ab.withHint);aa=this.$node.find(".tt-dropdown-menu");ac=this.$node.find(".tt-input");Z=this.$node.find(".tt-hint");ac.on("blur.tt",function(ae){var ag,af,ad;ag=document.activeElement;af=aa.is(ag);ad=aa.has(ag).length>0;if(q.isMsie()&&(af||ad)){ae.preventDefault();ae.stopImmediatePropagation();q.defer(function(){ac.focus()})}});aa.on("mousedown.tt",function(ad){ad.preventDefault()});this.eventBus=ab.eventBus||new a({el:ac});this.dropdown=new m({menu:aa,datasets:ab.datasets}).onSync("suggestionClicked",this._onSuggestionClicked,this).onSync("cursorMoved",this._onCursorMoved,this).onSync("cursorRemoved",this._onCursorRemoved,this).onSync("opened",this._onOpened,this).onSync("closed",this._onClosed,this).onAsync("datasetRendered",this._onDatasetRendered,this);this.input=new k({input:ac,hint:Z}).onSync("focused",this._onFocused,this).onSync("blurred",this._onBlurred,this).onSync("enterKeyed",this._onEnterKeyed,this).onSync("tabKeyed",this._onTabKeyed,this).onSync("escKeyed",this._onEscKeyed,this).onSync("upKeyed",this._onUpKeyed,this).onSync("downKeyed",this._onDownKeyed,this).onSync("leftKeyed",this._onLeftKeyed,this).onSync("rightKeyed",this._onRightKeyed,this).onSync("queryChanged",this._onQueryChanged,this).onSync("whitespaceChanged",this._onWhitespaceChanged,this);this._setLanguageDirection()}q.mixin(F.prototype,{_onSuggestionClicked:function v(ab,aa){var Z;if(Z=this.dropdown.getDatumForSuggestion(aa)){this._select(Z)}},_onCursorMoved:function Q(){var Z=this.dropdown.getDatumForCursor();this.input.setInputValue(Z.value,true);this.eventBus.trigger("cursorchanged",Z.raw,Z.datasetName)},_onCursorRemoved:function z(){this.input.resetInputValue();this._updateHint()},_onDatasetRendered:function L(){this._updateHint()},_onOpened:function w(){this._updateHint();this.eventBus.trigger("opened")},_onClosed:function C(){this.input.clearHint();this.eventBus.trigger("closed")},_onFocused:function N(){this.isActivated=true;this.dropdown.open()},_onBlurred:function O(){this.isActivated=false;this.dropdown.empty();this.dropdown.close()},_onEnterKeyed:function J(aa,Z){var ab,ac;ab=this.dropdown.getDatumForCursor();ac=this.dropdown.getDatumForTopSuggestion();if(ab){this._select(ab);Z.preventDefault()}else{if(this.autoselect&&ac){this._select(ac);Z.preventDefault()}}},_onTabKeyed:function Y(ab,aa){var Z;if(Z=this.dropdown.getDatumForCursor()){this._select(Z);aa.preventDefault()}else{this._autocomplete(true)}},_onEscKeyed:function T(){this.dropdown.close();this.input.resetInputValue()},_onUpKeyed:function u(){var Z=this.input.getQuery();this.dropdown.isEmpty&&Z.length>=this.minLength?this.dropdown.update(Z):this.dropdown.moveCursorUp();this.dropdown.open()},_onDownKeyed:function A(){var Z=this.input.getQuery();this.dropdown.isEmpty&&Z.length>=this.minLength?this.dropdown.update(Z):this.dropdown.moveCursorDown();this.dropdown.open()},_onLeftKeyed:function X(){this.dir==="rtl"&&this._autocomplete()},_onRightKeyed:function K(){this.dir==="ltr"&&this._autocomplete()},_onQueryChanged:function H(aa,Z){this.input.clearHintIfInvalid();Z.length>=this.minLength?this.dropdown.update(Z):this.dropdown.empty();this.dropdown.open();this._setLanguageDirection()},_onWhitespaceChanged:function U(){this._updateHint();this.dropdown.open()},_setLanguageDirection:function S(){var Z;if(this.dir!==(Z=this.input.getLanguageDirection())){this.dir=Z;this.$node.css("direction",Z);this.dropdown.setLanguageDirection(Z)}},_updateHint:function M(){var aa,ae,ad,ac,Z,ab;aa=this.dropdown.getDatumForTopSuggestion();if(aa&&this.dropdown.isVisible()&&!this.input.hasOverflow()){ae=this.input.getInputValue();ad=k.normalizeQuery(ae);ac=q.escapeRegExChars(ad);Z=new RegExp("^(?:"+ac+")(.+$)","i");ab=Z.exec(aa.value);ab?this.input.setHint(ae+ab[1]):this.input.clearHint()}else{this.input.clearHint()}},_autocomplete:function W(ab){var ad,ac,Z,aa;ad=this.input.getHint();ac=this.input.getQuery();Z=ab||this.input.isCursorAtEnd();if(ad&&ac!==ad&&Z){aa=this.dropdown.getDatumForTopSuggestion();aa&&this.input.setInputValue(aa.value);this.eventBus.trigger("autocompleted",aa.raw,aa.datasetName)}},_select:function I(Z){this.input.setQuery(Z.value);this.input.setInputValue(Z.value,true);this._setLanguageDirection();this.eventBus.trigger("selected",Z.raw,Z.datasetName);this.dropdown.close();q.defer(q.bind(this.dropdown.empty,this.dropdown))},open:function E(){this.dropdown.open()},close:function G(){this.dropdown.close()},setVal:function t(Z){Z=q.toStr(Z);if(this.isActivated){this.input.setInputValue(Z)}else{this.input.setQuery(Z);this.input.setInputValue(Z,true)}this._setLanguageDirection()},getVal:function D(){return this.input.getQuery()},destroy:function R(){this.input.destroy();this.dropdown.destroy();y(this.$node);this.$node=null}});return F;function P(Z,ae){var af,ab,ad,aa;af=b(Z);ab=b(h.wrapper).css(g.wrapper);ad=b(h.dropdown).css(g.dropdown);aa=af.clone().css(g.hint).css(B(af));aa.val("").removeData().addClass("tt-hint").removeAttr("id name placeholder required").prop("readonly",true).attr({autocomplete:"off",spellcheck:"false",tabindex:-1});af.data(V,{dir:af.attr("dir"),autocomplete:af.attr("autocomplete"),spellcheck:af.attr("spellcheck"),style:af.attr("style")});af.addClass("tt-input").attr({autocomplete:"off",spellcheck:false}).css(ae?g.input:g.inputWithNoHint);try{!af.attr("dir")&&af.attr("dir","auto")}catch(ac){}return af.wrap(ab).parent().prepend(ae?aa:null).append(ad)}function B(Z){return{backgroundAttachment:Z.css("background-attachment"),backgroundClip:Z.css("background-clip"),backgroundColor:Z.css("background-color"),backgroundImage:Z.css("background-image"),backgroundOrigin:Z.css("background-origin"),backgroundPosition:Z.css("background-position"),backgroundRepeat:Z.css("background-repeat"),backgroundSize:Z.css("background-size")}}function y(Z){var aa=Z.find(".tt-input");q.each(aa.data(V),function(ac,ab){q.isUndefined(ac)?aa.removeAttr(ab):aa.attr(ab,ac)});aa.detach().removeData(V).removeClass("tt-input").insertAfter(Z);Z.remove()}}();(function(){var v,t,w;v=b.fn.typeahead;t="ttTypeahead";w={initialize:function y(F,E){E=q.isArray(E)?E:[].slice.call(arguments,1);F=F||{};return this.each(D);function D(){var I=b(this),G,H;q.each(E,function(J){J.highlight=!!F.highlight});H=new j({input:I,eventBus:G=new a({el:I}),withHint:q.isUndefined(F.hint)?true:!!F.hint,minLength:F.minLength,autoselect:F.autoselect,datasets:E});I.data(t,H)}},open:function z(){return this.each(D);function D(){var F=b(this),E;if(E=F.data(t)){E.open()}}},close:function C(){return this.each(D);function D(){var F=b(this),E;if(E=F.data(t)){E.close()}}},val:function u(D){return !arguments.length?F(this.first()):this.each(E);function E(){var H=b(this),G;if(G=H.data(t)){G.setVal(D)}}function F(I){var H,G;if(H=I.data(t)){G=H.getVal()}return G}},destroy:function B(){return this.each(D);function D(){var F=b(this),E;if(E=F.data(t)){E.destroy();F.removeData(t)}}}};b.fn.typeahead=function(E){var D;if(w[E]&&E!=="initialize"){D=this.filter(function(){return !!b(this).data(t)});return w[E].apply(D,[].slice.call(arguments,1))}else{return w.initialize.apply(this,arguments)}};b.fn.typeahead.noConflict=function A(){b.fn.typeahead=v;return this}})()})(window.jQuery);
/*! 
 * Bennu Toolkit
 * https://github.com/FenixEdu/bennu
 * Copyright (c) 2014 Instituto Superior TÃ©cnico
 */
(function(){window.Bennu=window.Bennu||{};$(function(){Bennu.loaded=true});Bennu.version="4.0.0-SNAPSHOT";Bennu.toString=function(){return"Bennu Toolkit v"+Bennu.version};Bennu.gensym=function(){var e="";var c="abcdefghijklmnopqrstuvwxyz0123456789";for(var d=0;d<5;d++){e+=c.charAt(Math.floor(Math.random()*c.length))}return e};Bennu.contextPath=window.contextPath;if(!Bennu.contextPath){$("script").map(function(c,d){var e=d.getAttribute("src");if(e&&e.indexOf("/bennu-toolkit/js/toolkit.js")!=-1){Bennu.contextPath=e.substring(0,e.indexOf("/bennu-toolkit/js/toolkit.js"))}})}Bennu.contextPath=Bennu.contextPath||"";function a(c){c[0]=c[0].split(" ").map(function(d){return"bennu-toolkit-"+d}).reduce(function(d,e){return d+" "+e})}Bennu.on=function(){a(arguments);var c=$("html");c.on.apply(c,arguments)};Bennu.off=function(){a(arguments);var c=$("html");c.off.apply(c,arguments)};Bennu.trigger=function(){a(arguments);var c=$("html");c.trigger.apply(c,arguments)};Bennu.utils=Bennu.utils||{};Bennu.utils.updateAttrs=function(e,g,h){e=$(e);var d=g.data("attrCache");if(d){for(var f=0;f<d.length;f++){var c=d[f];if(Bennu.utils.hasAttr(e,c)){g.removeAttr(c)}}}d=[];$.each(e[0].attributes,function(j,k){if(!(h.indexOf(k.name)<0)){g.attr(k.name,k.value);d.push(k.name)}});g.data("attrCache",d)};Bennu.utils.hasAttr=function(d,c){var e=$(d).attr(c);return(typeof e!==typeof undefined&&e!==false)};Bennu.utils.replaceRequired=function(c){c=$(c);if(Bennu.utils.hasAttr(c,"required")){c.removeAttr("required");c.attr("bennu-required","required")}};Bennu.widgetHandler=Bennu.widgetHandler||{};Bennu.widgetHandler.makeFor=function(g,f){var d=[];var c={get:function(){return $(g).val()},set:function(e){$(g).val(e);$(g).trigger("change")},clear:function(e){this.set("")},onchange:function(e){d.push(e)},trigger:function(){for(var e=0;e<d.length;e++){d[e].apply(g,{type:"change",target:g})}},remove:function(){$(g).data("input").remove();$(g).data("input",null);$(g).data("handler",null);$(g).off(".bennu")}};$(g).data("handler",c);return c};var b=function(){if(Bennu.loaded){Bennu.trigger("load")}else{$(function(){Bennu.trigger("load")})}};if(Bennu.locales){b()}else{$.ajax({type:"GET",url:Bennu.contextPath+"/api/bennu-portal/data",async:false,dataType:"json",success:function(c,d,e){Bennu.username=c.username;Bennu.locales=c.locales;Bennu.locale=c.locale;Bennu.groups=c.groups;Bennu.lang=(function(f){if(f.indexOf("-")!=-1){return f.split("-")[0]}return f})(c.locale.tag);b()},error:function(e,c,d){Bennu.username=null;Bennu.locales=[{displayName:"English (United Kingdom)",lang:"en",tag:"en-GB"}];Bennu.locale={displayName:"English (United Kingdom)",lang:"en",tag:"en-GB"};Bennu.groups=null;Bennu.lang="en";b()}})}}).call(this);(function(){var c={};var b={};var a=function(e,d){this.isFulfilled=function(){var f=$.map(e,function(g){return Bennu.ensure.isLoaded(g)});return Array.prototype.reduce.apply(f,[function(g,h){return g&&h},true])};this.call=function(){if(this.isFulfilled()){d()}}};Bennu.ensure=Bennu.ensure||function(h,e){if(typeof h=="string"){h=[h]}var j=new a(h,e);if(!j.isFulfilled()){for(var g=0;g<h.length;g++){var f=h[g];if(!Bennu.ensure.isLoaded(f)){if(!b[f]){b[f]=[j];(function(i){var d=document.createElement("script");d.onload=function(){c[i]=true;console.log("loaded "+i);for(var k=0;k<b[i].length;k++){b[i][k].call()}};d.src=i;document.getElementsByTagName("head")[0].appendChild(d)})(f)}else{b[f].push(j)}}}}else{e()}};Bennu.ensure.isLoaded=function(d){return c[d]||false}})();(function(){var a=false;Bennu.validation={};Bennu.validation.attachToForm=function(d){var c=d.closest("form");if(!c.data("bennu-validator")){c.on("submit",function(f){try{var h=Array.prototype.reduce.apply([$("[bennu-localized-string]",c).map(function(e,j){j=$(j);j.data("input").removeClass("has-error");return Bennu.validation.validateLocalizedInput(j)}),$("[bennu-time],[bennu-date],[bennu-datetime]",c).map(function(e,j){j=$(j);j.data("input").removeClass("has-error");return Bennu.validation.validateDateTime(j)}),$("[bennu-html-editor]",c).map(function(e,j){j=$(j);if(Bennu.utils.hasAttr(j,"bennu-localized-string")){return true}j.data("input").removeClass("has-error");return Bennu.validation.validateInput(j)})],[$.merge,[]]);if(!Array.prototype.reduce.apply(h,[function(e,i){return e&&i},true])){f.preventDefault();return false}}catch(g){console.error(g.stack);return a}});c.data("bennu-validator",true)}};var b={"bennu-date":"You need to select one date","bennu-time":"You need to select a time","bennu-date-time":"You need to select a date and time"};Bennu.validation.validateDateTime=function(e){var c=e.val();var d=true;if(Bennu.utils.hasAttr(xx,"bennu-required")){if(!c){e.data("input").addClass("has-error");if(Bennu.utils.hasAttr(e,"bennu-time")){$(".help-block",e.data("input")).html(b["bennu-time"])}if(Bennu.utils.hasAttr(e,"bennu-date")){$(".help-block",e.data("input")).html(b["bennu-date"])}if(Bennu.utils.hasAttr(e,"bennu-datetime")){$(".help-block",e.data("input")).html(b["bennu-date-time"])}d=false}}return d};Bennu.validation.validateInput=function(e){var c=e.val();var d=true;if(Bennu.utils.hasAttr(e,"bennu-required")){if(!c){e.data("input").addClass("has-error");$(".help-block",e.data("input")).html("This field is required");d=false}}return d};Bennu.validation.validateLocalizedInput=function(e){var c=e.val()?JSON.parse(e.val()):null;if(Bennu.utils.hasAttr(e,"bennu-required")){var d=Bennu.locales.map(function(f){return Bennu.localizedString.getContent(c,f,true)||false}).reduce(function(f,g){return f&&g},true);if(!d){e.data("input").addClass("has-error");$(".help-block",e.data("input")).html("You need to to insert text in all languages")}return d}else{if(Bennu.utils.hasAttr(e,"required-any")){var d=Bennu.locales.map(function(f){return Bennu.localizedString.getContent(c,f,true)||false}).reduce(function(f,g){return f||g},false);if(!d){e.data("input").addClass("has-error");$(".help-block",e.data("input")).html("You need to to insert text in at least one language")}return d}}}})();(function(){Bennu.localizedString=Bennu.localizedString||{};Bennu.localizedString.attr="bennu-localized-string";Bennu.localizedString.inputValidAttr=["readonly","placeholder","maxlength","disabled"];Bennu.localizedString.textAreaValidAttr=["readonly","placeholder","maxlength","disabled"];function b(e){return e.tag.split("-")[0].toUpperCase()}function a(e,f){f.html(e.displayName||b(e));f.data("locale",e)}function d(e,f){if(f&&f.length){f.html(b(e))}}Bennu.localizedString.changeData=function(f,k,h,i,g){i=$(i);var j=$(i.data("related")).val();if(j===""){$(i.data("related")).val("{}");j="{}"}var j=JSON.parse(j);var e=f.tag;if(!(e in j)){singleTag=b(f).toLowerCase();if(singleTag in j){e=singleTag}}j=j[e];if(j!==h.val()){h.val(j||"");a(f,k);d(f,g);i.data("locale",f)}};Bennu.localizedString.updateValueForLanguage=function(h,g,k){var j=JSON.parse($(k.data("related")).val());var f=g.data("locale");var e=f.tag;if(!(e in j)){var i=b(f).toLowerCase();if(i in j){e=i}}j[e]=h.val();$(k.data("related")).val(JSON.stringify(j));$(k.data("related")).trigger("change")};Bennu.localizedString.makeLocaleList=function(j,h,k){for(var g=0;g<Bennu.locales.length;g++){var e=Bennu.locales[g];var f=$("<li><a href='#' onclick='return false;' >"+(e.displayName||e.tag)+"</a>");f.data("locale",e);f.on("click",k);j.append(f)}};Bennu.localizedString.getContent=function(g,f,h){if(!g||typeof g==="string"){return g}if(f&&typeof f!=="string"){var e=f.tag}else{if(!f){var e=Bennu.locale.tag}else{var e=f}}if(e in g){return g[e]}e=e.split("-")[0];if(e in g){return g[e]}for(var i in g){if(i.indexOf(e)===0){return g[i]}}return h?null:g[Object.keys(g)[0]]};Bennu.localizedString.createWidget=function(f){f=$(f);if(Bennu.utils.hasAttr(f,"bennu-html-editor")){return}if(!$(f).data("input")){if(f.prop("tagName")=="INPUT"){var j=$('<div class="bennu-localized-string-input-group" ><div class="input-group"><input type="text" class="form-control bennu-localized-string-input"><div class="input-group-btn bennu-localized-string-group"><button type="button" class=" btn btn-default dropdown-toggle bennu-localized-string-button-full bennu-localized-string-button" data-toggle="dropdown"><span class="bennu-localized-string-language"></span> <span class="caret"></span></button><button type="button" class=" btn btn-default dropdown-toggle bennu-localized-string-button-short bennu-localized-string-button" data-toggle="dropdown"><span class="bennu-localized-string-tag"></span> <span class="caret"></span></button></button><ul class="dropdown-menu bennu-localized-string-menu pull-right" role="menu"></ul></div></div><p class="help-block"></p></div>')}else{if(f.prop("tagName")=="TEXTAREA"){var j=$('<div class="bennu-localized-string-textArea"><p><div class="btn-group bennu-localized-string-group"><button type="button" class="btn btn-default dropdown-toggle bennu-localized-string-button" data-toggle="dropdown"><span class="bennu-localized-string-language"></span><span class="caret"></span></button><ul class="dropdown-menu bennu-localized-string-menu" role="menu"></ul></div></p><p><textarea class="form-control bennu-localized-string-textarea"></textarea><p class="help-block"></p></div>')}}j.data("related",f);Bennu.localizedString.makeLocaleList($(".bennu-localized-string-menu",j),j,function(l){Bennu.localizedString.changeData($(l.target).parent().data("locale"),$(".bennu-localized-string-language",j),$(".bennu-localized-string-input,.bennu-localized-string-textarea",j),j,$(".bennu-localized-string-tag",j))});Bennu.localizedString.changeData(Bennu.locale,$(".bennu-localized-string-language",j),$(".bennu-localized-string-input,.bennu-localized-string-textarea",j),j,$(".bennu-localized-string-tag",j));$(".bennu-localized-string-input,.bennu-localized-string-textarea",j).on("input propertychange",function(){Bennu.localizedString.updateValueForLanguage($(".bennu-localized-string-input,.bennu-localized-string-textarea",j),$(".bennu-localized-string-language",j),j);$(".help-block",j).empty();j.removeClass("has-error")});function h(){var l=k($(j).data("locale"))+1;if(l==Bennu.locales.length){l=0}return Bennu.locales[l]}function i(){var l=k($(j).data("locale"))-1;if(l<0){l=Bennu.locales.length-1}return Bennu.locales[l]}function k(m){var l=-1;$.map(Bennu.locales,function(o,n){if(o.tag==m.tag){l=n}});return l}var e=false;j.keydown(function(m){if(m.keyCode==18){e=true}else{if(e){var l;if(m.keyCode==40){l=h()}else{if(m.keyCode==38){l=i()}}if(l){Bennu.localizedString.changeData(l,$(".bennu-localized-string-language",j),$(".bennu-localized-string-input,.bennu-localized-string-textarea",j),j,$(".bennu-localized-string-tag",j))}}}});j.keyup(function(l){if(l.keyCode==18){e=false}});f.data("input",j);f.on("change.bennu",function(l){Bennu.localizedString.changeData(j.data("locale"),$(".bennu-localized-string-language",j),$(".bennu-localized-string-input,.bennu-localized-string-textarea",j),j,$(".bennu-localized-string-tag",j));f.data("handler").trigger()});f.after(j);Bennu.validation.attachToForm(j);c(j);Bennu.utils.replaceRequired(f);if(f.prop("tagName")=="INPUT"){var g=$(".bennu-localized-string-input",j);Bennu.utils.updateAttrs(f,g,Bennu.localizedString.inputValidAttr)}else{if(f.prop("tagName")=="TEXTAREA"){var g=$(".bennu-localized-string-textarea",j);Bennu.utils.updateAttrs(f,g,Bennu.localizedString.textAreaValidAttr)}}return Bennu.widgetHandler.makeFor(f)}};function c(e){e=e||$(".bennu-localized-string-input-group");e.map(function(g,h){h=$(h);var j=$(".bennu-localized-string-button-full",h);var f=$(".bennu-localized-string-button-short",h);if(f.length&&j.length){if((j.width()/h.width())>1/3){if(j[0].style.display!=="none"){f[0].style.display="inline";j[0].style.display="none"}}else{if(f[0].style.display!=="none"){j[0].style.display="inline";f[0].style.display="none"}}}})}$(window).resize(function(){c()})})();(function(){var f=false;var h=true;Bennu.htmlEditor=Bennu.htmlEditor||{};Bennu.htmlEditor.attr="bennu-html-editor";Bennu.htmlEditor.colors=[["#000000","#424242","#636363","#9C9C94","#CEC6CE","#EFEFEF","#F7F7F7","#FFFFFF"],["#FF0000","#FF9C00","#FFFF00","#00FF00","#00FFFF","#0000FF","#9C00FF","#FF00FF"],["#F7C6CE","#FFE7CE","#FFEFC6","#D6EFD6","#CEDEE7","#CEE7F7","#D6D6E7","#E7D6DE"],["#E79C9C","#FFC69C","#FFE79C","#B5D6A5","#A5C6CE","#9CC6EF","#B5A5D6","#D6A5BD"],["#E76363","#F7AD6B","#FFD663","#94BD7B","#73A5AD","#6BADDE","#8C7BC6","#C67BA5"],["#CE0000","#E79439","#EFC631","#6BA54A","#4A7B8C","#3984C6","#634AA5","#A54A7B"],["#9C0000","#B56308","#BD9400","#397B21","#104A5A","#085294","#311873","#731842"],["#630000","#7B3900","#846300","#295218","#083139","#003163","#21104A","#4A1031"]];Bennu.htmlEditor.saveSelection=function(){if(window.getSelection){sel=window.getSelection();if(sel.getRangeAt&&sel.rangeCount){return sel.getRangeAt(0)}}else{if(document.selection&&document.selection.createRange){return document.selection.createRange()}}return null};Bennu.htmlEditor.restoreSelection=function(i){if(i){if(window.getSelection){sel=window.getSelection();sel.removeAllRanges();sel.addRange(i)}else{if(document.selection&&i.select){i.select()}}}};function c(s){var k="";for(var q=0;q<Bennu.htmlEditor.colors.length;q++){var n=Bennu.htmlEditor.colors[q];var m='<div class="note-color-row">';for(var p=0;p<n.length;p++){var o=n[p];m+='<button type="button" class="note-color-btn" style="background-color:'+o+';" data-event="'+s+'" data-value="'+o+'" title="" data-toggle="button" tabindex="-1" data-original-title="'+o+'"></button>'}m+="</div>";k+=m}return k}Bennu.htmlEditor.fullscreen=function(n){var m=$(n.target);var j=m.closest(".bennu-html-editor-input");j.toggleFullScreen();j.addClass("fullscreen");$(".fullscreen-button",j).addClass("btn-primary");$(document).bind("fullscreenchange",function(){var i=($(document).fullScreen()?"on":"off");if(i=="off"){$(".fullscreen").removeClass("fullscreen");$(".fullscreen-button",j).removeClass("btn-primary");$(".bennu-html-editor-tools",j).off("mouseover mouseout");$(".switch-to-code",j).parent().show();j.removeClass("visible")}else{$(".switch-to-code",j).parent().hide()}});var k;function l(i){clearTimeout(k),j.hasClass("visible")&&"show"!==i?"autohide"!==i&&j.removeClass("visible"):j.addClass("visible"),"autohide"===i&&(k=setTimeout(function(){j.removeClass("visible")},2000))}$(".bennu-html-editor-tools",j).on("mouseover",function(){l("show")}).on("mouseout",function(){l("autohide")});l("show");k=setTimeout(function(){j.removeClass("visible")},2000);$(".bennu-html-editor-editor",j).focus()};var g=/\n\n/g;var a=/\n/g;function e(i){return i.replace(g,"<p></p>").replace(a,"<br>")}var d=/\S/;function b(i){return i.replace(d,function(j){return j.toUpperCase()})}Bennu.htmlEditor.createWidget=function(j){j=$(j);var i=Bennu.widgetHandler.makeFor(j);Bennu.ensure([Bennu.contextPath+"/bennu-toolkit/js/libs/bootstrap-wysiwyg.js",Bennu.contextPath+"/bennu-toolkit/js/libs/jquery.fullscreen.js",Bennu.contextPath+"/bennu-toolkit/js/libs/sanitize.js",Bennu.contextPath+"/bennu-toolkit/js/libs/jquery.hotkeys.js"],function(){var q=$('<div class="bennu-html-editor-input"><div class="bennu-html-editor-tools"><div class="bennu-html-editor-toolbar btn-toolbar" data-role="editor-toolbar" data-target=".bennu-html-editor-editor"></div></div><div class="bennu-html-editor-editor form-control editor-input" contenteditable="true"></div><span class="help-block"></span></div>');var k="size,style,lists,align,links,table,image,undo,fullscreen,source";if(Bennu.utils.hasAttr(j,"toolbar")){k=j.attr("toobar")}k=k.split(",");for(var u=0;u<k.length;u++){var w=k[u];if(w==="size"){$(".btn-toolbar",q).append('<div class="btn-group"><a class="btn btn-sm btn-default dropdown-toggle" data-toggle="dropdown" title="" data-original-title="Style"><span class="fa fa-header"></span>&nbsp;<b class="caret"></b></a><ul class="dropdown-menu"><li><a data-edit="formatBlock p" href="#" data-value="">Normal</a></li><li><a data-edit="formatBlock blockquote" href="#" data-value="">Quote</a></li><li><a data-edit="formatBlock pre" href="#">Code</a></li><li><a data-edit="formatBlock h1" href="#">Header 1</a></li><li><a data-edit="formatBlock h2" href="#">Header 2</a></li><li><a data-edit="formatBlock h3" href="#">Header 3</a></li><li><a data-edit="formatBlock h4" href="#">Header 4</a></li><li><a data-edit="formatBlock h5" href="#">Header 5</a></li><li><a data-edit="formatBlock h6" href="#">Header 6</a></li></ul></div>')}else{if(w==="style"){$(".btn-toolbar",q).append('<div class="btn-group"><a class="btn btn-sm btn-default" data-edit="bold" title="" data-original-title="Bold (Ctrl/Cmd+B)"><span class="glyphicon glyphicon-bold"></span></a><a class="btn btn-sm btn-default" data-edit="italic" title="" data-original-title="Italic (Ctrl/Cmd+I)"><span class="glyphicon glyphicon-italic"></span></a><a class="btn btn-sm btn-default" data-edit="strikethrough" title="" data-original-title="Strikethrough"><span class="fa fa-strikethrough"></span></a><a class="btn btn-sm btn-default" data-edit="underline" title="" data-original-title="Underline (Ctrl/Cmd+U)"><span class="fa fa-underline"></span></a><a class="btn btn-sm btn-default" data-edit="superscript" title="" data-original-title="Superscript"><i class="fa fa-superscript icon-superscript"></i></a><a class="btn btn-sm btn-default" data-edit="subscript" title="" data-original-title="Subscript"><i class="fa fa-subscript icon-subscript"></i></a><a class="btn btn-sm btn-default" data-edit="removeFormat" title="" data-original-title="Remove Font Style"><i class="fa fa-eraser"></i></a></div>')}else{if(w==="lists"){$(".btn-toolbar",q).append('<div class="btn-group"><a class="btn btn-sm btn-default" data-edit="insertunorderedlist" title="" data-original-title="Bullet list"><span class="fa fa-list-ul"></span></a><a class="btn btn-sm btn-default" data-edit="insertorderedlist" title="" data-original-title="Number list"><span class="fa fa-list-ol"></span></a></div>')}else{if(w==="align"){$(".btn-toolbar",q).append('<div class="btn-group"><a class="btn btn-sm btn-default dropdown-toggle" data-toggle="dropdown" title="" data-original-title="Paragraph"><span class="fa fa-align-left"></span>&nbsp;<b class="caret"></b></a><ul class="dropdown-menu menu-paragraph"><li><div class="btn-group"><a class="btn btn-sm btn-default" data-edit="outdent" title="" data-original-title="Reduce indent (Shift+Tab)"><span class="glyphicon glyphicon-indent-left"></span></a><a class="btn btn-sm btn-default" data-edit="indent" title="" data-original-title="Indent (Tab)"><span class="glyphicon glyphicon-indent-right"></span></a></div><div class="btn-group"><a class="btn btn-sm btn-default btn-primary" data-edit="justifyleft" title="" data-original-title="Align Left (Ctrl/Cmd+L)"><span class="glyphicon glyphicon-align-left"></span></a><a class="btn btn-sm btn-default" data-edit="justifycenter" title="" data-original-title="Center (Ctrl/Cmd+E)"><span class="glyphicon glyphicon-align-center"></span></a><a class="btn btn-sm btn-default" data-edit="justifyright" title="" data-original-title="Align Right (Ctrl/Cmd+R)"><span class="glyphicon glyphicon-align-right"></span></a><a class="btn btn-sm btn-default" data-edit="justifyfull" title="" data-original-title="Justify (Ctrl/Cmd+J)"><span class="glyphicon glyphicon-align-justify"></span></a></div></li></ul></div>')}else{if(w==="links"){$(".btn-toolbar",q).append('<div class="btn-group"><a class="btn btn-sm btn-default link-to-add-ui-btn dropdown-toggle" data-toggle="dropdown" title="" data-original-title="Hyperlink"><span class="glyphicon glyphicon-link"></span></a><div class="dropdown-menu input-append add-url"><div class="input-group"><input type="text" placeholder="URL" class="link-to-add form-control"><div class="input-group-btn"><button type="button" class="btn btn-default link-to-add-btn" aria-expanded="false">Add</button></div></div></div><a class="btn btn-sm btn-default" data-edit="unlink" title="" data-original-title="Remove Hyperlink"><span class="fa fa-chain-broken"></span></a></div>')}else{if(w==="table"){$(".btn-toolbar",q).append('<div class="btn-group"><button type="button" class="btn btn-default btn-sm btn-small dropdown-toggle" data-toggle="dropdown" title="" tabindex="-1" data-original-title="Table"><i class="fa fa-table icon-table"></i> <span class="caret"></span></button><div class="dropdown-menu input-append note-table"><div class="note-dimension-picker"><div class="note-dimension-picker-mousecatcher" data-event="insertTable" data-value="1x1"></div><div class="note-dimension-picker-highlighted"></div><div class="note-dimension-picker-unhighlighted"></div></div><div class="note-dimension-display"> 1 x 1 </div></div></div>')}else{if(w==="colors"){$(".btn-toolbar",q).append('<div class="note-color btn-group"><button type="button" class="btn btn-default btn-sm btn-small note-recent-color" title="" data-event="color" data-value="{&quot;backColor&quot;:&quot;yellow&quot;}" tabindex="-1" data-original-title="Recent Color"><i class="fa fa-font icon-font" style="color:black;background-color:yellow;"></i></button><button type="button" class="btn btn-default btn-sm btn-small dropdown-toggle" data-toggle="dropdown" title="" tabindex="-1" data-original-title="More Color"><span class="caret"></span></button><ul class="dropdown-menu"><li><div class="btn-group"><div class="note-palette-title">Background Color</div><a class="note-color-reset" href="#" data-event="backColor" data-value="inherit" title="Transparent">Set transparent</a><div class="note-color-palette" data-target-event="backColor">'+c("backColor")+'</div></div><div class="btn-group"><div class="note-palette-title">Foreground Color</div><a href="#" class="note-color-reset" data-event="foreColor" data-value="inherit" title="Reset">Reset to default</a><div class="note-color-palette" data-target-event="foreColor">'+c("foreColor")+"</div></div></li></ul></div>")}else{if(w==="image"){$(".btn-toolbar",q).append('<div class="btn-group"><a class="pictureBtn btn btn-sm btn-default" title="" data-original-title="Insert picture (or just drag &amp; drop)"><span class="glyphicon glyphicon-picture"></span></a><input type="file" name="pictureTlb" style="display:none;" multiple></div>')}else{if(w==="undo"){$(".btn-toolbar",q).append('<div class="btn-group"><a class="btn btn-sm btn-default" data-edit="undo" title="" data-original-title="Undo (Ctrl/Cmd+Z)"><span class="fa fa-undo"></span></a><a class="btn btn-sm btn-default" data-edit="redo" title="" data-original-title="Redo (Ctrl/Cmd+Y)"><span class="fa fa-repeat"></span></a></div>')}else{if(w==="fullscreen"&&h){$(".btn-toolbar",q).append('<div class="btn-group"><a href="#" title="" data-original-title="Enter Zen Mode" class="btn btn-sm btn-default fullscreen-button"><span class="fa fa-arrows-alt"></span></a></div>');$(".fullscreen-button",q).on("click",Bennu.htmlEditor.fullscreen)}else{if(w==="source"){$(".btn-toolbar",q).append('<div class="btn-group"><a class="btn btn-sm btn-default switch-to-code" title="" data-original-title="Switch to Source"><span class="fa fa-code"></span></a></div>');$(".bennu-html-editor-editor",q).after("<div class='bennu-html-code-editor-container' style='display:none;'><pre class='bennu-html-code-editor'></pre></div>")}}}}}}}}}}}}$("a[title]",q).tooltip({container:"body"});$("[data-role=magic-overlay]",q).each(function(){var s=$(this),D=$(s.data("target"));s.css("opacity",0).css("position","absolute").offset(D.offset()).width(D.outerWidth()).height(D.outerHeight())});$(".dropdown-menu input",q).click(function(){return false}).change(function(){$(this).parent(".dropdown-menu").siblings(".dropdown-toggle").dropdown("toggle")}).keydown("esc",function(){this.value="";$(this).change()});q.data("related",j);j.data("input",q);function B(D,s){var E="";if(D==="unsupported-file-type"){E="Unsupported format "+s}else{console.log("error uploading file",D,s)}$('<div class="alert"> <button type="button" class="close" data-dismiss="alert">&times;</button><strong>File upload error</strong> '+E+" </div>").prependTo("#alerts")}var C=new Sanitize(Sanitize.Config.RELAXED);$(".bennu-html-editor-editor",q).on("paste",function(){setTimeout(function(){$(".bennu-html-editor-editor",q).html(C.clean_node($(".bennu-html-editor-editor",q)[0]))})});$(".bennu-html-editor-editor",q).on("focus",function(){var s=$(this);s.data("before",s.html());return s}).on("blur keyup paste input",function(){var s=$(this);if(s.data("before")!==s.html()){s.data("before",s.html());s.trigger("change")}return s});var y={};y.val=function(){if(arguments.length===0){return $(".bennu-html-editor-editor",q).html()}else{return $(".bennu-html-editor-editor",q).html(arguments[0])}};if(Bennu.utils.hasAttr(j,"bennu-localized-string")){var n=$('<div class="btn-group bennu-localized-string-group"><button type="button" class="btn btn-default dropdown-toggle bennu-localized-string-button" data-toggle="dropdown"><span class="bennu-localized-string-language"></span> <span class="caret"></span></button><ul class="dropdown-menu bennu-localized-string-menu" role="menu"></ul></div>');$("div.btn-toolbar",q).before(n);q.data("localized-string",true);Bennu.localizedString.makeLocaleList($(".bennu-localized-string-menu",q),q,function(s){Bennu.localizedString.changeData($(s.target).parent().data("locale"),$(".bennu-localized-string-language",q),y,q)});Bennu.localizedString.changeData(Bennu.locale,$(".bennu-localized-string-language",q),y,q);if(j.val()===""){j.val("{}")}}else{var o=j.val();if(o){$(".bennu-html-editor-editor",q).html(j.val())}else{$(".bennu-html-editor-editor",q).html("")}}$(".bennu-html-editor-editor",q).on("change",function(){if(Bennu.utils.hasAttr(j,"bennu-localized-string")){var H=JSON.parse($(q.data("related")).val());var D=$(".bennu-localized-string-language",q).data("locale");var s=D.tag;if(!(s in H)){var F=D.tag.split("-")[0].toLowerCase();if(F in H){s=F}}H[s]=y.val();$(q.data("related")).val(JSON.stringify(H));$(".help-block",q).empty();q.removeClass("has-error");q.data("related").trigger("change")}else{var G=q.data("related").val();var E=$(".bennu-html-editor-editor",q).html();if(G!==E){q.data("related").val($(".bennu-html-editor-editor",q).html());q.data("related").trigger("change")}}});$(".btn-toolbar .pictureBtn",q).on("click",function(){$(".btn-toolbar input[name='pictureTlb']",q).click()});var t=function(D){$(".bennu-html-editor-editor",q).focus();for(var s=0;s<D.length;s++){var E=D[s];document.execCommand("insertimage",0,E)}};$(".btn-toolbar input[name='pictureTlb']",q).on("change",function(s){var D=j.data("fileHandler");D&&D($(".btn-toolbar input[name='pictureTlb']",q)[0].files,t)});q.on("dragenter dragover",false).on("drop",function(s){var D=s.originalEvent.dataTransfer;s.stopPropagation();s.preventDefault();if(D&&D.files&&D.files.length>0){var E=j.data("fileHandler");E&&E(D.files,t)}});$(".bennu-html-editor-editor",q).wysiwyg({dragAndDropImages:false,fileUploadError:B});j.after(q);Bennu.validation.attachToForm(q);Bennu.utils.replaceRequired(j);var A=18;var p=function(D,L){var F=$(D.target.parentNode);var E=F.next();var K=F.find(".note-dimension-picker-mousecatcher");var G=F.find(".note-dimension-picker-highlighted");var H=F.find(".note-dimension-picker-unhighlighted");var J;if(D.offsetX===undefined){var s=$(D.target).offset();J={x:D.pageX-s.left,y:D.pageY-s.top}}else{J={x:D.offsetX,y:D.offsetY}}var I={c:Math.ceil(J.x/A)||1,r:Math.ceil(J.y/A)||1};G.css({width:I.c+"em",height:I.r+"em"});K.attr("data-value",I.c+"x"+I.r);if(3<I.c&&I.c<10){H.css({width:I.c+1+"em"})}if(3<I.r&&I.r<10){H.css({height:I.r+1+"em"})}E.html(I.c+" x "+I.r)};var z=function(H,E){var G=[],D;for(var F=0;F<H;F++){G.push("<td>&nbsp;</td>")}D=G.join("");var s=[],I;for(var J=0;J<E;J++){s.push("<tr>"+D+"</tr>")}I=s.join("");return'<table class="table table-bordered">'+I+"</table>"};var v=$(".btn-toolbar",q).find(".note-dimension-picker-mousecatcher");v.css({width:10+"em",height:10+"em"}).on("mousemove",function(s){p(s,{})});$(".note-dimension-picker-mousecatcher",q).on("click",function(){var s=$(this).attr("data-value").split("x");$(".bennu-html-editor-editor",q).focus();document.execCommand("insertHTML",false,z(parseInt(s[0]),parseInt(s[1])))});$(".link-to-add-ui-btn",q).on("click",function(){var s=Bennu.htmlEditor.saveSelection();$(".bennu-html-editor-editor",q).data("save-selection",s);setTimeout(function(){$(".link-to-add",q).focus()},100)});$(".link-to-add-btn",q).on("click",function(){var s=$(".bennu-html-editor-editor",q).data("save-selection");$(".bennu-html-editor-editor",q).focus();setTimeout(function(){if(s){Bennu.htmlEditor.restoreSelection(s)}document.execCommand("CreateLink",false,$(".link-to-add").val());$(".link-to-add").val("")})});j.on("change.bennu",function(H){if(Bennu.utils.hasAttr(j,"bennu-localized-string")){var J=$(j).val();if(J===null||J===undefined||J===""){J="{}";$(j).val(J)}var I=JSON.parse(J);var D=$(".bennu-localized-string-language",q).data("locale");var s=D.tag;if(!(s in I)){var F=D.tag.split("-")[0].toLowerCase();if(F in I){s=F}}var E=I[s]||"";var G=$(".bennu-html-editor-editor",q).html();if(G!==E){$(".bennu-html-editor-editor",q)[0].innerHTML=E}}else{var E=$(j).val();var G=$(".bennu-html-editor-editor",q).html();if(G!==E){$(".bennu-html-editor-editor",q)[0].innerHTML=E}}j.data("handler").trigger()});var m=function(E,s){var D=$(".bennu-html-code-editor",E).data("editor");if(D){s(D);return}Bennu.codeEditor.require(function(){D=ace.edit($(".bennu-html-code-editor",E)[0]);D.setFontSize(13);D.setTheme("ace/theme/clouds");D.getSession().setMode("ace/mode/html");D.setHighlightActiveLine(false);D.setShowPrintMargin(false);D.getSession().setUseWrapMode(true);$(".bennu-html-code-editor",E).data("editor",D);D.on("input",function(){if(Bennu.utils.hasAttr(E.data("related"),"bennu-localized-string")){var I=JSON.parse(i.get());var G=$(".bennu-localized-string-language",E).data("locale");var F=G.tag;if(!(F in I)){var H=G.tag.split("-")[0].toLowerCase();if(H in I){F=H}}I[F]=D.getValue();i.set(JSON.stringify(I))}else{i.set(D.getValue())}});s(D)})};if($(".bennu-html-code-editor",q).length!=0){q.data("showSrc",false);$(".switch-to-code",q).on("click",function(){m(q,function(G){if(!q.data("showSrc")){$(".bennu-html-editor-toolbar .btn",q).map(function(){(!$(this).hasClass("switch-to-code"))&&$(this).attr("disabled","")});$(".switch-to-code",q).addClass("active btn-primary");$(".bennu-html-editor-editor",q).hide();$(".bennu-html-code-editor-container",q).show();$(".bennu-localized-string-button",q).attr("disabled","");if(Bennu.utils.hasAttr(j,"bennu-localized-string")){var H=JSON.parse(i.get());var D=$(".bennu-localized-string-language",q).data("locale");var s=D.tag;if(!(s in H)){var F=D.tag.split("-")[0].toLowerCase();if(F in H){s=F}}var E=H[s];G.setValue(E)}else{G.setValue()}q.data("showSrc",true)}else{$(".bennu-html-editor-toolbar .btn",q).map(function(){$(this).removeAttr("disabled")});$(".switch-to-code",q).removeClass("active btn-primary");$(".bennu-localized-string-button",q).removeAttr("disabled");$(".bennu-html-editor-editor",q).show();$(".bennu-html-code-editor-container",q).hide();if(Bennu.utils.hasAttr(j,"bennu-localized-string")){var H=JSON.parse(i.get());var D=$(".bennu-localized-string-language",q).data("locale");var s=D.tag;if(!(s in H)){var F=D.tag.split("-")[0].toLowerCase();if(F in H){s=F}}H[s]=G.getValue();i.set(JSON.stringify(H))}else{i.set(G.getValue())}q.data("showSrc",false)}})})}var l=function(s){if(s.backColor==="inherit"&&s.foreColor==="inherit"){document.execCommand("removeFormat",false)}else{document.execCommand("backColor",false,s.backColor);if(s.foreColor==="inherit"){document.execCommand("foreColor",false,"#444")}else{document.execCommand("foreColor",false,s.foreColor)}}};if($(".note-color",q).length!=0){$("[data-event='backColor']").map(function(){$(this).on("click",function(E){var F=$(E.target);var s=F.data("value");var D=$(".note-recent-color",q).data("value");D.backColor=s;$(".note-recent-color i",q).css("background-color",s);$(".note-recent-color",q).data("value",D);l(D)})});$("[data-event='foreColor']").map(function(){$(this).on("click",function(E){var F=$(E.target);$(".bennu-html-editor-editor",q).focus();var s=F.data("value");var D=$(".note-recent-color",q).data("value");D.foreColor=s;$(".note-recent-color i",q).css("color",s);$(".note-recent-color",q).data("value",D);l(D)})});$(".note-recent-color",q).on("click",function(){l($(".note-recent-color",q).data("value"))})}});return i}})();(function(){Bennu.group=Bennu.group||{};Bennu.group.attr="bennu-group";Bennu.group.selectionClass="btn-info";Bennu.group.template='<div class="btn-group bennu-group-widget"></div>';Bennu.group.allow={};Bennu.group.allow["public"]={name:"Public",group:"anyone",icon:"glyphicon glyphicon-globe"};Bennu.group.allow.users={name:"Users",group:"logged",icon:"glyphicon glyphicon-user"};Bennu.group.allow.managers={name:"Managers",group:"#managers",icon:"glyphicon glyphicon-eye-open"};Bennu.group.allow.custom={name:"Custom",group:"custom",icon:"glyphicon glyphicon-wrench"};Bennu.group.modalTemplate='<div class="bennu-group-custom-modal modal fade"><div class="modal-dialog"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button><h4 class="modal-title">Custom Group</h4></div><p><div class="modal-body"><p><small><b>Add User:</b></small></p><div class="row"><div class="col-sm-12"><input placeholder="Username" class="user-search form-control"/></div></div></p><p><small><b>Group users:</b></small></p><div class="bennu-group-list" style="height:149px; overflow:scroll; border:1px solid #ddd; margin-top:20px;"><table class="table table-striped"></table></div></div><div class="modal-footer"><button type="button" class="btn btn-default" data-dismiss="modal">Close</button></div></div><!-- /.modal-content --></div><!-- /.modal-dialog --></div><!-- /.modal -->';Bennu.group.modalClearUsers=function(){$(".bennu-group-list table",Bennu.group.customModal).empty()};Bennu.group.modalAddUserToModal=function(h){var g=$('<tr class="bennu-group-custom-user" data-username="'+h.username+'"><td class="col-xs-1"><img class="img-circle" src="'+h.avatar+'?s=32" alt="" /></td><td class="col-xs-9"><div><b>'+h.displayName+"</b></div><div><small>"+h.username+'</small></div></td><td class="col-xs-2"><button class="btn btn-sm btn-warning">Remove</button></td></tr>');$("button",g).on("click",function(l){l=$(l.target).closest(".bennu-group-custom-user");var n=l.data("username");l.remove();var m=Bennu.group.customModal.data("input");var k=d(m);for(var j=k.length-1;j>=0;j--){if(k[j]===n){k.splice(j,1)}}a(k,m)});$(".bennu-group-list table",Bennu.group.customModal).append(g)};function c(i){var g=i.data("related");var h=g.val();$("."+Bennu.group.selectionClass,i).removeClass(Bennu.group.selectionClass);if($("[data-role='"+h+"']",i).length){$("[data-role='"+h+"']",i).addClass(Bennu.group.selectionClass)}else{if(h.substring(0,2)==="U("){$("[data-role='custom']",i).addClass(Bennu.group.selectionClass)}else{$("button",i).addClass("disabled");i.attr("data-trigger","hover").attr("data-placement","right").data("title","Disabled, group is too complex.").tooltip({})}}}Bennu.group.setupModal=function(){$(document.body).append(Bennu.group.modalTemplate);var h=function(i){return function j(l,k){k(states)}};var g=new Bloodhound({datumTokenizer:function(i){return Bloodhound.tokenizers.whitespace(i.value)},queryTokenizer:Bloodhound.tokenizers.whitespace,remote:{url:Bennu.contextPath+"/api/bennu-core/users/find",replace:function(i,j){return i+"?query="+j+"&maxHits=10"},ajax:{beforeSend:function(j,i){},type:"POST"},filter:function(i){return i.users}}});g.initialize();$(".bennu-group-custom-modal .user-search").typeahead({hint:true,highlight:true,minLength:1,},{name:"custom-group-username",displayKey:"value",source:g.ttAdapter(),templates:{empty:['<div class="empty-message">',"No User Found","</div>"].join("\n"),suggestion:function(i){Bennu.group.userCache[i.username]=i;return'<p><div class="row"><div class="col-xs-1"><img class="img-circle" src="'+i.avatar+'?s=32" alt="" /></div><div class="col-sm-11"><div>'+i.displayName+"</div><div>"+i.username+"</div></div></div></p>"}}}).on("typeahead:autocompleted typeahead:selected",function(i,m,l){Bennu.group.modalAddUserToModal(m);var k=Bennu.group.customModal.data("input");var j=d(k);j.push(m.username);a(j,k)})};function d(h){var g=h.data("customCache");g=g.substring(2,g.length-1).split(",");g=$.map(g,function(i){return i.trim()});if(g.length==1&&g[0]===""){g=[]}return g}function a(k,l){var g="";for(var h=0;h<k.length;h++){g+=k[h];if(h<k.length-1){g+=", "}}var j="U("+g+")";l.data("customCache",j);l.data("related").val(j)}function b(k){Bennu.group.customModal=$(".bennu-group-custom-modal");Bennu.group.customModal.data("input",k);var j=d(k);$(".bennu-group-list table").empty();for(var h=0;h<j.length;h++){var g=Bennu.group.userCache[j[h]];Bennu.group.modalAddUserToModal(g)}Bennu.group.customModal.modal("show")}function f(h){var g=h.data("related");if(g.val()===""){g.val("U()")}if(g.val()=="nobody"){g.val("U()")}if(g.val().substring(0,2)=="U("){h.data("customCache",g.val())}else{h.data("customCache","U()")}$.map(d(h),e)}Bennu.group.userCache={};function e(g){$.post(Bennu.contextPath+"/api/bennu-core/users/find?query="+g+"&maxHits=10",{},function(h){Bennu.group.userCache[g]=h.users[0]})}Bennu.group.createWidget=function(h){h=$(h);var m=$(Bennu.group.template);var l=h.attr("allow")||"public,users,custom";l=l.split(",");for(var j=0;j<l.length;j++){var k=Bennu.group.allow[l[j]];if(k){var g='<button type="button" data-role="'+k.group+'" class="btn btn-sm btn-default"><span class="'+k.icon+'"></span> '+k.name+"</button>";m.append(g)}else{console.warn("Unknown permission type "+l[j])}}m.data("related",h);h.data("input",m);$("button",m).click(function(i){i=$(i.target).closest("button");var n=i.closest(".bennu-group-widget");if(i.data("role")!="custom"){n.data("related").val(i.data("role"))}else{n.data("related").val(n.data("customCache")||"U()");b(n)}c(n);n.data("related").trigger("change")});h.after(m);f(m);c(m);h.on("change.bennu",function(i){f(m);c(m);h.data("handler").trigger()});return Bennu.widgetHandler.makeFor(h)}})();(function(){Bennu.semanticVersion=Bennu.semanticVersion||function(a){var b=/^[^\d]*(\d+)\.(\d+)\.(\d+)(.*)?/g.exec(a);if(!b){return null}this.major=parseInt(b[1]);this.minor=parseInt(b[2]);this.revision=parseInt(b[3]);var c=b[4];if(c){if(c=="-SNAPSHOT"){this.snapshot=true}b=c.toUpperCase().match(/^[\-\.]?A(LPHA)?\-?(\d+)/);if(b){this.alpha=parseInt(b[2])}b=c.toUpperCase().match(/^[\-\.]?B(ETA)?[\-\.]?(\d+)/);if(b){this.beta=parseInt(b[2])}b=c.toUpperCase().match(/^[\-\.]?RC(\d+)/);if(b){this.releaseCandidate=parseInt(b[1])}b=c.toUpperCase().match(/^[\-\.]?M(\d+)/);if(b){this.milestone=parseInt(b[1])}}this.version=a};Bennu.semanticVersion.prototype.toString=function(){return this.version};Bennu.semanticVersion.prototype.cmp=function(e){if(this.major!==e.major){return this.major-e.major}if(this.minor!==e.minor){return this.minor-e.minor}if(this.revision!==e.revision){return this.revision-e.revision}var d=["alpha","beta","milestone","releaseCandidate","snapshot"];var c=0;var b=this;var f=e;var a;$.map(d,function(h){if(b[h]){var g=c;$.map(d,function(i){if(f[i]){if(i==h){if(i==="snapshot"){a=a||0}else{a=a||b[h]-f[i]}}else{a=a||g}}g-=1});a=a||g}c+=1});return a||0};Bennu.semanticVersion.prototype.before=function(b,a){if(typeof b==="string"){b=new Bennu.semanticVersion(b)}if(this.cmp(b)<=0){try{a(b)}catch(c){console.error(c)}}return this};Bennu.semanticVersion.prototype.after=function(b,a){if(typeof b==="string"){b=new Bennu.semanticVersion(b)}if(this.cmp(b)>=0){try{a(b)}catch(c){console.error(c)}}return this};Bennu.semanticVersion.prototype.between=function(d,c,a){if(typeof d==="string"){d=new Bennu.semanticVersion(d)}if(typeof c==="string"){c=new Bennu.semanticVersion(c)}if(this.cmp(d)>=0&&this.cmp(c)<=0){try{a(d,c)}catch(b){console.error(b)}}return this};Bennu.version=new Bennu.semanticVersion(Bennu.version)||new Bennu.semanticVersion("1.0.0-SNAPSHOT")})();(function(){Bennu.userAutocomplete=Bennu.userAutocomplete||{};Bennu.userAutocomplete.attr="bennu-user-autocomplete";Bennu.userAutocomplete.setup=function(){var a=null;a=new Bloodhound({datumTokenizer:function(b){return Bloodhound.tokenizers.whitespace(b.value)},queryTokenizer:Bloodhound.tokenizers.whitespace,limit:10,remote:{url:Bennu.contextPath+"/api/bennu-core/users/find",replace:function(b,c){return b+"?query="+c+"&maxHits=10"},ajax:{beforeSend:function(c,b){},type:"POST"},filter:function(b){return b.users}}});a.initialize();return a};Bennu.userAutocomplete.bloodhound=Bennu.userAutocomplete.bloodhound||Bennu.userAutocomplete.setup();Bennu.userAutocomplete.createWidget=function(b){var b=$(b);var e=$('<div class="bennu-user-autocomplete-input-group input-group"><input type="text" class="bennu-user-autocomplete-input form-control"/><span class="input-group-addon"><span class="glyphicon glyphicon-user"></span></span></div>');var f=$("input",e);var c=b.prop("attributes");$.each(c,function(){if(this.name===Bennu.userAutocomplete.attr||this.name==="name"||this.name==="id"||this.name==="value"){return true}var i=f.attr(this.name);f.attr(this.name,(i?i+" ":"")+this.value)});b.attr("type","hidden");f.show();var h="user-autocomplete-"+Bennu.gensym();f.attr("id",h);e.insertAfter(b);var d=[];var a={input:b,value:undefined,get:function(){return this.value},set:function(i){this.value=i;this.trigger("change")},clear:function(i){this.set("")},onchange:function(i){d.push(i)},trigger:function(){var j=this;for(var k=0;k<d.length;k++){d[k].apply(j,{type:"change",target:this})}},};f.on("keyup",function(i){var k=f.val();var j=a.get();if(j&&j.username!=k){a.clear();f.typeahead("val",k)}});a.onchange(function(){var i=this.get();if(i&&i.hasOwnProperty("username")&&i.hasOwnProperty("name")){$(b).val(i.username);f.typeahead("val",i.name)}else{$(b).val("");f.typeahead("val","")}});$("#"+h).typeahead({hint:true,highlight:true,minLength:3,},{name:"username",displayKey:function(i){return i.displayName},source:Bennu.userAutocomplete.bloodhound.ttAdapter(),templates:{empty:['<div class="empty-message">',"No User Found","</div>"].join("\n"),suggestion:function(i){return'<p><div class="row"><div class="col-xs-1"><img class="img-circle" src="'+i.avatar+'?s=32" alt="" /></div><div class="col-sm-11"><div>'+i.displayName+"</div><div>"+i.username+"</div></div></div></p>"}}}).on("typeahead:autocompleted typeahead:selected",function(j,i,k){a.set(i)});a.handler=Bennu.widgetHandler.makeFor(b);var g=$(b).val();if(g){$.ajax({url:Bennu.contextPath+"/api/bennu-core/users/find?query="+g+"&maxHits=1",dataType:"json",method:"POST",success:function(i){a.set(i.users[0])}})}return a}})();(function(){Bennu.theme=Bennu.theme||{};var a={};function d(f){if(!(f in a)){var e=$("<button style='display:none;' class='btn btn-"+f+"'></button>");$(document.body).append(e);var g=e.css("backgroundColor");e.remove();a[f]=g;return g}else{return a[f]}}function c(){if(!("paragraph" in a)){var e=$("<p style='display:none;'></p>");$(document.body).append(e);var f=e.css("fontFamily");e.remove();a.paragraph=f;return f}else{return a.paragraph}}function b(){if(!("heading" in a)){var e=$("<h1 style='display:none;'></h1>");$(document.body).append(e);var f=e.css("fontFamily");e.remove();a.heading=f;return f}else{return a.heading}}Bennu.theme.hFontFamily=function(){return b()};Bennu.theme.pFontFamily=function(){return c()};Bennu.theme.primary=function(){return d("primary")};Bennu.theme.success=function(){return d("success")};Bennu.theme.info=function(){return d("info")};Bennu.theme.warning=function(){return d("warning")};Bennu.theme.danger=function(){return d("danger")}})();(function(){function a(i){i=i.trim();if(i===""){var j=[0,0,0]}else{if(i.indexOf(".")>0){var h=i.split(".");i=h[0];var f=parseInt(h[1])}else{var f=0}var j=i.split(":");j[0]=parseInt(j[0]);j[1]=(j[1]&&parseInt(j[1]))||0;j[2]=(j[2]&&parseInt(j[2]))||0}var g=new Date();g.setHours(j[0]);g.setMinutes(j[1]);g.setSeconds(j[2]);g.setMilliseconds(f);return g}function c(f){f=$(f);if(Bennu.utils.hasAttr(f,"type")){var g=f.attr("type");if(g!=="text"&&g!=="hidden"){throw"Date/Time input field using non aceptable type"}}}Bennu.datetime=Bennu.datetime||{};Bennu.datetime.createWidget=function(h){var h=$(h);c(h);var i=(h.attr("bennu-datetime")==="");var f=(h.attr("bennu-date")==="");var g=(h.attr("bennu-time")==="");if(i||(f&&g)){return Bennu.datetime.createDateTimeWidget(h)}if(f){return Bennu.datetime.createDateWidget(h)}if(g){return Bennu.datetime.createTimeWidget(h)}};function d(k,g){if(Bennu.utils.hasAttr(k,"min-date")){g.minDate=new Date(k.attr("min-date"))}if(Bennu.utils.hasAttr(k,"max-date")){g.maxDate=new Date(k.attr("max-date"))}if(Bennu.utils.hasAttr(k,"requires-future")){g.minDate=new moment()}if(Bennu.utils.hasAttr(k,"requires-past")){g.maxDate=new moment()}if(Bennu.utils.hasAttr(k,"requires-future")&&Bennu.utils.hasAttr(k,"requires-past")){throw"Error: Due to limitations on the space-time continuum, choosing dates of past and future would break the causality principle."}if(Bennu.utils.hasAttr(k,"unavailable-dates")){var j=k.attr("unavailable-dates").split(",");var f=[];for(var h=0;h<j.length;h++){f.add(new Date(j[h]))}g.disabledDates=f}if(Bennu.utils.hasAttr(k,"available-dates")){var j=k.attr("available-dates").split(",");var f=[];for(var h=0;h<j.length;h++){f.add(new Date(j[h]))}g.enabledDates=f}return}Bennu.datetime.createDateWidget=function(g){var f=Bennu.widgetHandler.makeFor(g);Bennu.ensure(Bennu.contextPath+"/bennu-toolkit/js/libs/moment.js",function(){Bennu.ensure(Bennu.contextPath+"/bennu-toolkit/js/libs/datepicker.js",function(){g=$(g);c(g);var j=$('<div class="bennu-datetime-input-group input-group date"><span class="input-group-addon"><span class="glyphicon glyphicon-calendar"></span></span><input data-date-format="DD/MM/YYYY" type="text" class="bennu-datetime-input form-control"/></div>');var h=g.val();if(h){if(h.trim()!==""){h=new Date(h);g.val(moment(h).format("YYYY-MM-DD"))}}else{g.val("")}var i={};if(h){i.defaultDate=h}d(g,i);$("input",j).on("change",function(k){k=$(k.target);var l;if(k.val()==""){l=""}else{l=moment(k.val(),"DD/MM/YYYY").format("YYYY-MM-DD")}if(l!==g.val()){g.val(l);g.trigger("change")}}).datetimepicker(i).on("dp.change",function(l){x=$("input",j);var k;var m=x.val()||"";if(m==""){k=""}else{k=moment(m,"DD/MM/YYYY").format("YYYY-MM-DD")}if(k!==g.val()){g.val(k);g.trigger("change")}});g.after(j);g.on("change.bennu",function(m){var n=$(g).val();if(n.trim()==""){n=new Date()}else{n=new Date(n)}g.val(moment(n).format("YYYY-MM-DD"));var l=$(".bennu-datetime-input",j).data("DateTimePicker").setDate(moment(n).format("DD/MM/YYYY"));var k=moment(n).format("DD/MM/YYYY");if(l!==k){$(".bennu-datetime-input",j).data("DateTimePicker").setDate(k)}g.data("handler").trigger()});g.data("input",j);j.data("related",g);Bennu.validation.attachToForm(j);Bennu.utils.replaceRequired(g)})});return f};function b(g,f){if(Bennu.utils.hasAttr(g,"minute-stepping")){f.minuteStepping=parseInt(g.attr("minute-stepping"))}}function e(f){if(Bennu.utils.hasAttr(f,"only-hours")){return"HH"}else{if(Bennu.utils.hasAttr(f,"no-seconds")){return"HH:mm"}else{return"HH:mm:ss"}}}Bennu.datetime.createTimeWidget=function(g){var f=Bennu.widgetHandler.makeFor(g);Bennu.ensure(Bennu.contextPath+"/bennu-toolkit/js/libs/moment.js",function(){Bennu.ensure(Bennu.contextPath+"/bennu-toolkit/js/libs/datepicker.js",function(){g=$(g);c(g);var l=$('<div class="bennu-datetime-input-group input-group date"><span class="input-group-addon"><span class="glyphicon glyphicon-time"></span></span><input type="text" data-date-format="HH:mm:ss" class="bennu-datetime-input form-control"/></div>');var h=g.val();if(h&&h.trim()!=""){h=a(h);g.val(moment(h).format("HH:mm:ss.SSS"))}var i={};if(h){i.defaultDate=h}b(g,i);$("input",l).on("change",function(m){m=$(m.target);var p=m.val();if(p.trim()==""){var o=""}else{var n=moment(a(p));n.millisecond(0);if(Bennu.utils.hasAttr(g,"no-seconds")){n=n.seconds(0)}if(Bennu.utils.hasAttr(g,"only-hours")){n=n.seconds(0);n=n.minutes(0)}o=n.format("HH:mm:ss.SSS")}if(o!==g.val()){g.val(o);g.trigger("change")}}).datetimepicker(i).on("dp.change",function(m){m=$("input",l);var n;var o=m.val()||"";if(o.trim()==""){n=""}else{n=moment(a(o)).format("HH:mm:ss.SSS")}if(n!==g.val()){g.val(n);g.trigger("change")}});g.after(l);if(data.trim()!==""){data=a(data);g.val(moment(data).format("HH:mm:ss.SSS"));var k=$(".bennu-datetime-input",l).data("DateTimePicker").date();var j=moment(data).format("HH:mm:ss");if(k!==j){$(".bennu-datetime-input",l).data("DateTimePicker").date(j)}}g.on("change.bennu",function(o){var p=$(g).val();if(p.trim()==""){p=new Date()}else{p=a(p)}g.val(moment(p).format("HH:mm:ss.SSS"));var n=$(".bennu-datetime-input",l).data("DateTimePicker").setDate(moment(p).format("HH:mm:ss"));var m=moment(p).format("HH:mm:ss");if(n!==m){$(".bennu-datetime-input",l).data("DateTimePicker").setDate(m)}g.data("handler").trigger()});g.data("input",l);l.data("related",g);Bennu.validation.attachToForm(l);Bennu.utils.replaceRequired(g)})});return f};Bennu.datetime.createDateTimeWidget=function(g){var f=Bennu.widgetHandler.makeFor(g);Bennu.ensure(Bennu.contextPath+"/bennu-toolkit/js/libs/moment.js",function(){Bennu.ensure(Bennu.contextPath+"/bennu-toolkit/js/libs/datepicker.js",function(){g=$(g);c(g);var j=$('<div class="bennu-datetime-input-group input-group date"><span class="input-group-addon"><span class="glyphicon glyphicon-calendar"></span></span><input data-date-format="DD/MM/YYYY HH:mm:ss" type="text" class="bennu-datetime-input form-control"/></div>');var h=g.val();if(h&&h.trim()!=""){h=new Date(h);g.val(moment(h).format("YYYY-MM-DDTHH:mm:ss.SSSZ"))}var i={sideBySide:true,};if(h){i.defaultDate=h}d(g,i);b(g,i);$("input",j).on("change",function(k){k=$(k.target);var m=k.val().trim();if(m==""){g.val("")}else{var l=moment(m,"DD/MM/YYYY "+e(g));l.millisecond(0);if(Bennu.utils.hasAttr(g,"no-seconds")){l=l.seconds(0)}if(Bennu.utils.hasAttr(g,"only-hours")){l=l.seconds(0);l=l.minutes(0)}r=l.format("YYYY-MM-DDTHH:mm:ss.SSSZ");if(r!==g.val()){g.val(r);g.trigger("change")}}}).datetimepicker(i).on("dp.change",function(k){k=$("input",j);var m=k.val().trim();if(m==""){g.val("")}else{var l=moment(m,"DD/MM/YYYY HH:mm:ss").format("YYYY-MM-DDTHH:mm:ss.SSSZ");if(l!==g.val()){g.val(l);g.trigger("change")}}});g.after(j);g.data("input");j.data("related",g);g.on("change.bennu",function(m){var n=$(g).val();if(n.trim()==""){n=new Date()}else{n=new Date(n)}g.val(moment(n).format("YYYY-MM-DDTHH:mm:ss.SSSZ"));var l=$(".bennu-datetime-input",j).data("DateTimePicker").date();var l=(l&&l.format("DD/MM/YYYY HH:mm:ss"));var k=moment(n).format("DD/MM/YYYY HH:mm:ss");if(l!==k){$(".bennu-datetime-input",j).data("DateTimePicker").date(k)}g.data("handler").trigger()});g.data("input",j);j.data("related",g);Bennu.validation.attachToForm(j);Bennu.utils.replaceRequired(g)})});return f}}());(function(){Bennu.codeEditor=Bennu.codeEditor||{};Bennu.codeEditor.attr="bennu-code-editor";var a='<div class="modal fade" id="bennu-code-editor-modal"><div class="modal-dialog"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal"><span class="sr-only">Close</span></button><h3 class="modal-title">Code Editor</h3><small>Options</small></div><div class="modal-body form-horizontal"><div class="form-group"><label for="inputEmail3" class="col-sm-3 control-label">Highlight Mode</label><div class="col-sm-9"><select class="form-control" id="bennu-code-editor-modal-mode"></select><p class="help-block">Choose what type of code you are editing</p></div></div><div class="form-group"><label for="inputEmail3" class="col-sm-3 control-label">Text Size</label><div class="col-sm-9"><input type="text" class="form-control" id="bennu-code-editor-modal-size"/></div></div><div class="form-group"><label for="inputEmail3" class="col-sm-3 control-label">Theme</label><div class="col-sm-9"><select class="form-control" id="bennu-code-editor-modal-themes"></select><p class="help-block">Select the editor appearance</p></div></div></div><div class="modal-footer"><button type="button" class="btn btn-default" data-dismiss="modal">Close</button><button type="button" class="btn btn-primary bennu-code-editor-modal-save">Save</button></div></div></div></div>';Bennu.codeEditor.THEMES={ambiance:"Ambiance",chaos:"Chaos",chrome:"Chrome",clouds:"Clouds",clouds_midnight:"Clouds Midnight",cobalt:"Cobalt",crimson_editor:"Crimson Editor",dawn:"Dawn",dreamweaver:"Dreamweaver",eclipse:"Eclipse",github:"GitHub",idle_fingers:"idleFingers",katzenmilch:"Katzenmilch",kr_theme:"KR Theme",kuroir:"Kuroir",merbivore:"Merbivore",merbivore_soft:"Merbivore Soft",mono_industrial:"Mono Industrial",monokai:"Monokai",pastel_on_dark:"Pastel on Dark",solarized_dark:"Solarized Dark",solarized_light:"Solarized Light",terminal:"Terminal",textmate:"TextMate",tomorrow:"Tomorrow",tomorrow_night:"Tomorrow Night",tomorrow_night_blue:"Tomorrow Night Blue",tomorrow_night_bright:"Tomorrow Night Bright",tomorrow_night_eighties:"Tomorrow Night Eighties",twilight:"Twilight",vibrant_ink:"Vibrant Ink",xcode:"XCode"};Bennu.codeEditor.MODES={abap:"ABAP",actionscript:"ActionScript",ada:"Ada",apache_conf:"Apache Configuration",applescript:"AppleScript",asciidoc:"AsciiDoc",assembly_x86:"Assembly x86",autohotkey:"AutoHotkey",batchfile:"Batch file",c9search:"C9 Search",c_cpp:"c++",cirru:"Cirru",clojure:"Clojure",cobol:"COBOL",coffee:"CoffeeScript",coldfusion:"ColdFusion",csharp:"C#",css:"CSS",curly:"Curly",d:"D",dart:"Dart",diff:"Diff",django:"Django",dockerfile:"Dockerfile",dot:"Dot",eiffel:"Eiffel",elixir:"Elixir",elm:"Elm",erlang:"Erlang",forth:"Forth",ftl:"FreeMarker Template Language",gcode:"GCode",gherkin:"Gherkin",gitignore:"Gitignore",glsl:"OpenGL Shading Language",golang:"Go",groovy:"Groovy",haml:"HAML",handlebars:"Handlebars",haskell:"Haskell",haxe:"Haxe",html:"HTML",html_ruby:"HTML Ruby",ini:"Ini",io:"IO",jack:"Jack",jade:"Jade",java:"java",javascript:"Javascript",json:"JSON",jsoniq:"JSON Query Language",jsp:"Java Server Pages",jsx:"JSX",julia:"Julia",latex:"LaTeX",less:"LESS",liquid:"liquid",lisp:"LISP",livescript:"LiveScript",logiql:"LogiQL",lsl:"lsl",lua:"Lua",luapage:"Lua Page",lucene:"Lucene",makefile:"Makefile",markdown:"Markdown",matlab:"MATLAB",mel:"Mel",mushcode:"MUSHCode",mysql:"MySQL",nix:"Nix",objectivec:"Objective-C",ocaml:"OCaml",pascal:"Pascal",perl:"perl",pgsql:"PostgresQL",php:"PHP",plain_text:"Plain Text",powershell:"PowerShell",praat:"Praat",prolog:"Prolog",properties:"Properties",protobuf:"protobuf",python:"Python",r:"R",rdoc:"RDoc",rhtml:"RHTML",ruby:"Ruby",rust:"Rust",sass:"SASS",scad:"SCad",scala:"Scala",scheme:"Scheme",scss:"SCSS",sh:"Shell Script",smarty:"smarty",snippets:"Snippets",soy_template:"Soy Template",space:"Space",sql:"SQL",stylus:"Stylus",svg:"SVG",tcl:"Tcl",tex:"TeX",text:"Text",textile:"Textile",toml:"Tom's Obvious, Minimal Language",twig:"Twig",typescript:"TypeScript",vala:"Vala",vbscript:"VBScript",velocity:"Velocity",verilog:"Verilog",vhdl:"VHSIC Hardware Description Language",xml:"XML",xquery:"XQuery",yaml:"YAML"};Bennu.codeEditor.MIME_TYPES={"text/x-c":"c_cpp"};getModeFromMime=function(c){c=c.toLowerCase();if(c in Bennu.codeEditor.MODES){return c}if(c in Bennu.codeEditor.MIME_TYPES){return Bennu.codeEditor.MIME_TYPES[c]}var b=c.split("/");if(b.length==2){b=b[1];if(b.startsWith("x-")){b=b.substring(2)}if(b in Bennu.codeEditor.MODES){return b}}return"plain_text"};Bennu.codeEditor.require=function(b){Bennu.ensure(Bennu.contextPath+"/webjars/ace/1.1.9/src-min-noconflict/ace.js",function(){if(b){b()}})};Bennu.codeEditor.changeMode=function(e,d){var c=d.data("editor");var b=d.data("statusbar");var f=getModeFromMime(e);d.data("mode",f);c.getSession().setMode("ace/mode/"+f);$(".bennu-code-editor-lang",b).html(Bennu.codeEditor.MODES[f])};Bennu.codeEditor.showModal=function(b){$("#bennu-code-editor-modal-mode").val(b.data("mode"));$("#bennu-code-editor-modal-size").val(localStorage.getItem("bennuCodeEditorFontSize"));$("#bennu-code-editor-modal-themes").val(localStorage.getItem("bennuCodeEditorTheme"));$("#bennu-code-editor-modal").data("editor",b);$("#bennu-code-editor-modal").modal("show")};Bennu.codeEditor.changeTheme=function(b){$("[bennu-code-editor]").map(function(c,d){$(d).data("editor").setTheme("ace/theme/"+b)});localStorage.setItem("bennuCodeEditorTheme",b)};Bennu.codeEditor.changeFontSize=function(b){$("[bennu-code-editor]").map(function(c,d){$(d).data("editor").setFontSize(parseInt(b))});localStorage.setItem("bennuCodeEditorFontSize",b)};Bennu.codeEditor.createWidget=function(b){Bennu.ensure(Bennu.contextPath+"/webjars/ace/1.1.9/src-min-noconflict/ace.js",function(){Bennu.ensure(Bennu.contextPath+"/webjars/ace/1.1.9/src-min-noconflict/ext-statusbar.js",function(){b=$(b);var f=$('<div class="bennu-code-editor-statusbar">Mode: <a href="#" class="bennu-code-editor-lang"></a> &#8212; </div>');b.after(f);var c=b[0];var h=ace.edit(c);var i=ace.require("ace/ext/statusbar").StatusBar;var k=new i(h,f[0]);b.data("editor",h);b.data("statusbar",f);f.data("editor",b);var e=localStorage.getItem("bennuCodeEditorFontSize");var d=localStorage.getItem("bennuCodeEditorTheme");if(!e){e=13;localStorage.setItem("bennuCodeEditorFontSize",e)}if(!d){d="clouds";localStorage.setItem("bennuCodeEditorTheme",d)}h.setTheme("ace/theme/"+d);h.setFontSize(parseInt(e));if($("#bennu-code-editor-modal").length==0){$(document.body).append(a);var m=$("#bennu-code-editor-modal");var j=$("#bennu-code-editor-modal-mode");for(var l in Bennu.codeEditor.MODES){j.append("<option value='"+l+"'>"+Bennu.codeEditor.MODES[l]+"</options>")}var j=$("#bennu-code-editor-modal-themes");for(var l in Bennu.codeEditor.THEMES){j.append("<option value='"+l+"'>"+Bennu.codeEditor.THEMES[l]+"</options>")}$(".bennu-code-editor-modal-save").on("click",function(o){Bennu.codeEditor.changeTheme($("#bennu-code-editor-modal-themes").val());Bennu.codeEditor.changeFontSize($("#bennu-code-editor-modal-size").val());Bennu.codeEditor.changeMode($("#bennu-code-editor-modal-mode").val(),b);m.modal("hide")})}$(".bennu-code-editor-lang",f).on("click",function(p){var o=$(p.target).closest(".bennu-code-editor-statusbar").data("editor");Bennu.codeEditor.showModal(o)});var g=$(b).attr("type")||"plain_text";Bennu.codeEditor.changeMode(g,b);h.setHighlightActiveLine(false);h.setShowPrintMargin(false);var n={get:function(){return h.getSession().getValue()},set:function(o){h.setValue(o,1);$(b).trigger("change")},clear:function(o){h.setValue("",1)},onchange:function(o){events.push(o)},trigger:function(){for(var o=0;o<events.length;o++){events[o].apply(b,{type:"change",target:b})}},remove:function(){b.remove()}};b.data("handler",n);return n})})}})();(function(){Bennu.spinner=Bennu.spinner||{};Bennu.spinner.attr="bennu-spinner";Bennu.spinner.createWidget=function(b){b=$(b);var a="<i class='bennu-spinner-widget icon icon-spin'></i>";var c=$(a);b.data("widget",c);c.data("related",b);if(Bennu.utils.hasAttr(b,"faster")){Bennu.spinner.faster(b)}if(Bennu.utils.hasAttr(b,"slower")){Bennu.spinner.slower(b)}if(Bennu.utils.hasAttr(b,"color")){c.css("color",Bennu.theme[$(b).attr("color")]())}b.after(c)};Bennu.spinner.faster=function(a){a=$(a);a.data("widget").addClass("bennu-spinner-faster");a.data("widget").removeClass("bennu-spinner-slower")};Bennu.spinner.normal=function(a){a=$(a);a.data("widget").removeClass("bennu-spinner-faster");a.data("widget").removeClass("bennu-spinner-slower")};Bennu.spinner.slower=function(a){a=$(a);a.data("widget").removeClass("bennu-spinner-faster");a.data("widget").addClass("bennu-spinner-slower")}})();(function(s){if(typeof WeakMap==="undefined"){(function(){var B=Object.defineProperty;var A=Date.now()%1000000000;var C=function(){this.name="__st"+(Math.random()*1000000000>>>0)+(A+++"__")};C.prototype={set:function(D,F){var E=D[this.name];if(E&&E[0]===D){E[1]=F}else{B(D,this.name,{value:[D,F],writable:true})}},get:function(D){var E;return(E=D[this.name])&&E[0]===D?E[1]:undefined},"delete":function(D){this.set(D,undefined)}};window.WeakMap=C})()}var y=new WeakMap();var u=window.msSetImmediate;if(!u){var j=[];var o=String(Math.random());window.addEventListener("message",function(B){if(B.data===o){var A=j;j=[];A.forEach(function(C){C()})}});u=function(A){j.push(A);window.postMessage(o,"*")}}var g=false;var i=[];function d(A){i.push(A);if(!g){g=true;u(k)}}function z(A){return window.ShadowDOMPolyfill&&window.ShadowDOMPolyfill.wrapIfNeeded(A)||A}function k(){g=false;var B=i;i=[];B.sort(function(D,C){return D.uid_-C.uid_});var A=false;B.forEach(function(D){var C=D.takeRecords();q(D);if(C.length){D.callback_(C,D);A=true}});if(A){k()}}function q(A){A.nodes_.forEach(function(B){var C=y.get(B);if(!C){return}C.forEach(function(D){if(D.observer===A){D.removeTransientObservers()}})})}function f(G,H){for(var E=G;E;E=E.parentNode){var F=y.get(E);if(F){for(var D=0;D<F.length;D++){var C=F[D];var B=C.options;if(E!==G&&!B.subtree){continue}var A=H(B);if(A){C.enqueue(A)}}}}}var t=0;function n(A){this.callback_=A;this.nodes_=[];this.records_=[];this.uid_=++t}n.prototype={observe:function(E,B){E=z(E);if(!B.childList&&!B.attributes&&!B.characterData||B.attributeOldValue&&!B.attributes||B.attributeFilter&&B.attributeFilter.length&&!B.attributes||B.characterDataOldValue&&!B.characterData){throw new SyntaxError()}var D=y.get(E);if(!D){y.set(E,D=[])}var A;for(var C=0;C<D.length;C++){if(D[C].observer===this){A=D[C];A.removeListeners();A.options=B;break}}if(!A){A=new v(this,E,B);D.push(A);this.nodes_.push(E)}A.addListeners()},disconnect:function(){this.nodes_.forEach(function(C){var D=y.get(C);for(var B=0;B<D.length;B++){var A=D[B];if(A.observer===this){A.removeListeners();D.splice(B,1);break}}},this);this.records_=[]},takeRecords:function(){var A=this.records_;this.records_=[];return A}};function h(A,B){this.type=A;this.target=B;this.addedNodes=[];this.removedNodes=[];this.previousSibling=null;this.nextSibling=null;this.attributeName=null;this.attributeNamespace=null;this.oldValue=null}function p(B){var A=new h(B.type,B.target);A.addedNodes=B.addedNodes.slice();A.removedNodes=B.removedNodes.slice();A.previousSibling=B.previousSibling;A.nextSibling=B.nextSibling;A.attributeName=B.attributeName;A.attributeNamespace=B.attributeNamespace;A.oldValue=B.oldValue;return A}var c,e;function a(A,B){return c=new h(A,B)}function b(A){if(e){return e}e=p(c);e.oldValue=A;return e}function m(){c=e=undefined}function w(A){return A===e||A===c}function l(B,A){if(B===A){return B}if(e&&w(B)){return e}return null}function v(A,C,B){this.observer=A;this.target=C;this.options=B;this.transientObservedNodes=[]}v.prototype={enqueue:function(A){var B=this.observer.records_;var C=B.length;if(B.length>0){var D=B[C-1];var E=l(D,A);if(E){B[C-1]=E;return}}else{d(this.observer)}B[C]=A},addListeners:function(){this.addListeners_(this.target)},addListeners_:function(B){var A=this.options;if(A.attributes){B.addEventListener("DOMAttrModified",this,true)}if(A.characterData){B.addEventListener("DOMCharacterDataModified",this,true)}if(A.childList){B.addEventListener("DOMNodeInserted",this,true)}if(A.childList||A.subtree){B.addEventListener("DOMNodeRemoved",this,true)}},removeListeners:function(){this.removeListeners_(this.target)},removeListeners_:function(B){var A=this.options;if(A.attributes){B.removeEventListener("DOMAttrModified",this,true)}if(A.characterData){B.removeEventListener("DOMCharacterDataModified",this,true)}if(A.childList){B.removeEventListener("DOMNodeInserted",this,true)}if(A.childList||A.subtree){B.removeEventListener("DOMNodeRemoved",this,true)}},addTransientObserver:function(A){if(A===this.target){return}this.addListeners_(A);this.transientObservedNodes.push(A);var B=y.get(A);if(!B){y.set(A,B=[])}B.push(this)},removeTransientObservers:function(){var A=this.transientObservedNodes;this.transientObservedNodes=[];A.forEach(function(C){this.removeListeners_(C);var D=y.get(C);for(var B=0;B<D.length;B++){if(D[B]===this){D.splice(B,1);break}}},this)},handleEvent:function(I){I.stopImmediatePropagation();switch(I.type){case"DOMAttrModified":var C=I.attrName;var D=I.relatedNode.namespaceURI;var J=I.target;var G=new a("attributes",J);G.attributeName=C;G.attributeNamespace=D;var B=I.attrChange===MutationEvent.ADDITION?null:I.prevValue;f(J,function(L){if(!L.attributes){return}if(L.attributeFilter&&L.attributeFilter.length&&L.attributeFilter.indexOf(C)===-1&&L.attributeFilter.indexOf(D)===-1){return}if(L.attributeOldValue){return b(B)}return G});break;case"DOMCharacterDataModified":var J=I.target;var G=a("characterData",J);var B=I.prevValue;f(J,function(L){if(!L.characterData){return}if(L.characterDataOldValue){return b(B)}return G});break;case"DOMNodeRemoved":this.addTransientObserver(I.target);case"DOMNodeInserted":var J=I.relatedNode;var K=I.target;var H,E;if(I.type==="DOMNodeInserted"){H=[K];E=[]}else{H=[];E=[K]}var A=K.previousSibling;var F=K.nextSibling;var G=a("childList",J);G.addedNodes=H;G.removedNodes=E;G.previousSibling=A;G.nextSibling=F;f(J,function(L){if(!L.childList){return}return G})}m()}};s.JsMutationObserver=n;if(!s.MutationObserver){s.MutationObserver=n}})(this);(function(){Bennu.monitor=Bennu.monitor||{};Bennu.monitor.checkFor=function(a,e){var d=document.querySelector("body");var b=new MutationObserver(function(f){$.map(f,function(g){$.map(g.addedNodes,function(j){var h=$("["+a+"]",$(j)).length!==0;var i=$(j).attr(a)==="";if(i){e.add&&e.add(j)}else{if(h){$("["+a+"]",$(j)).map(function(l,k){e.add&&e.add(k)})}}});$.map(g.removedNodes,function(h){e.remove&&e.remove(h)})})});var c={attributes:true,subtree:true,childList:true,characterData:true};b.observe(d,c)};Bennu.on("load",function(){$("[bennu-datetime],[bennu-time],[bennu-date]").each(function(f,g){Bennu.datetime.createWidget(g)});Bennu.monitor.checkFor("bennu-date",{add:function(f){Bennu.datetime.createWidget(f)},remove:function(f){if(Bennu.utils.hasAttr(f,"bennu-date")){$(f).data("handler").remove()}}});Bennu.monitor.checkFor("bennu-time",{add:function(f){Bennu.datetime.createWidget(f)},remove:function(f){if(Bennu.utils.hasAttr(f,"bennu-time")){$(f).data("handler").remove()}}});Bennu.monitor.checkFor("bennu-datetime",{add:function(f){Bennu.datetime.createWidget(f)},remove:function(f){if(Bennu.utils.hasAttr(f,"bennu-datetime")){$(f).data("handler").remove()}}});var a=$("["+Bennu.group.attr+"]");if(a.size()>0){Bennu.group.setupModal()}a.map(function(f,g){Bennu.group.createWidget(g)});Bennu.monitor.checkFor(Bennu.group.attr,{add:function(f){Bennu.group.createWidget(f)},remove:function(f){f=$(f);if(Bennu.utils.hasAttr(f,Bennu.group.attr)){$(f).data("handler").remove()}}});$("[bennu-localized-string]").map(function(f,g){Bennu.localizedString.createWidget(g)});Bennu.monitor.checkFor(Bennu.localizedString.attr,{add:function(f){Bennu.localizedString.createWidget(f)},remove:function(f){if(Bennu.utils.hasAttr(f,Bennu.localizedString.attr)){$(f).data("handler").remove()}}});$("["+Bennu.htmlEditor.attr+"]").map(function(f,g){Bennu.htmlEditor.createWidget(g)});Bennu.monitor.checkFor(Bennu.htmlEditor.attr,{add:function(f){Bennu.htmlEditor.createWidget(f)},remove:function(f){if(Bennu.utils.hasAttr(f,Bennu.htmlEditor.attr)){$(f).data("handler").remove()}}});var c=$("["+Bennu.codeEditor.attr+"]");c.map(function(f,g){Bennu.codeEditor.createWidget(g)});Bennu.monitor.checkFor(Bennu.codeEditor.attr,{add:function(f){Bennu.codeEditor.createWidget(f)},remove:function(f){if(Bennu.utils.hasAttr(f,Bennu.codeEditor.attr)){$(f).data("handler").remove()}}});var b=$("["+Bennu.userAutocomplete.attr+"]");b.map(function(f,g){Bennu.userAutocomplete.createWidget(g)});Bennu.monitor.checkFor(Bennu.userAutocomplete.attr,{add:function(f){Bennu.userAutocomplete.createWidget(f)},remove:function(f){if(Bennu.utils.hasAttr(f,Bennu.userAutocomplete.attr)){$(f).data("handler").remove()}}});var d=$("["+Bennu.spinner.attr+"]");d.map(function(f,g){Bennu.spinner.createWidget(g)});Bennu.monitor.checkFor(Bennu.spinner.attr,{add:function(f){Bennu.spinner.createWidget(f)},remove:function(f){if($(f).attr(Bennu.spinner.attr)===""){$(f).data("widget").remove()}}})})})();